<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, viewport-fit=cover">
    <title>WillFort GSquad Dashboard</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #4361ee;
            --secondary: #3f37c9;
            --success: #4cc9f0;
            --warning: #f72585;
            --light: #f8f9fa;
            --dark: #0f0f1a;
            --text-light: #ffffff;
            --text-dark: #121212;
            --card-bg: rgba(30, 30, 46, 0.7);
            --sidebar-width: 60px;
            --font-size: 13px;
            --online: #4cc9f0;
            --offline: #a0a0c0;
            --data-bg: #1a237e;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Roboto', 'Helvetica Neue', Arial, sans-serif;
        }
        
        body {
            background-color: var(--dark);
            color: var(--text-light);
            font-size: var(--font-size);
            line-height: 1.4;
            height: 100vh;
            overflow: hidden;
        }
        
        .input-group {
            position: relative;
        }
        
        .input-filled::after {
            content: '✓';
            position: absolute;
            right: 10px;
            top: 38px;
            color: #4cc9f0;
            font-weight: bold;
            font-size: 14px;
        }
        
        .input-error {
            border-color: #f72585 !important;
            background: rgba(247, 37, 133, 0.1) !important;
        }
        
        .input-error::after {
            content: '✗';
            position: absolute;
            right: 10px;
            top: 38px;
            color: #f72585;
            font-weight: bold;
            font-size: 14px;
        }
        
        .validation-message {
            font-size: 12px;
            color: #4cc9f0;
            margin-top: 5px;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .validation-error {
            color: #f72585;
        }
        
        .setup-progress {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
            padding: 10px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
        }
        
        .progress-step {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
            flex: 1;
        }
        
        .step-indicator {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            transition: all 0.3s ease;
        }
        
        .step-indicator.completed {
            background: #4cc9f0;
            border-color: #4cc9f0;
            color: white;
        }
        
        .step-label {
            font-size: 11px;
            color: rgba(255, 255, 255, 0.7);
            text-align: center;
        }
        
        .ceo-setup-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.98);
            z-index: 9999;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        .ceo-setup-content {
            background: linear-gradient(135deg, rgba(20, 20, 40, 0.95), rgba(30, 30, 60, 0.95));
            border-radius: 20px;
            padding: 40px 30px;
            width: 100%;
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
            border: 1px solid rgba(76, 201, 240, 0.3);
            box-shadow: 0 0 40px rgba(76, 201, 240, 0.2);
            position: relative;
        }
        
        .ceo-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid rgba(76, 201, 240, 0.3);
        }
        
        .ceo-header h1 {
            color: #4cc9f0;
            font-size: 28px;
            margin-bottom: 10px;
            background: linear-gradient(45deg, #4cc9f0, #4361ee);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 0 20px rgba(76, 201, 240, 0.3);
        }
        
        .setup-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 25px;
        }
        
        .user-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 25px;
            border: 1px solid rgba(76, 201, 240, 0.2);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .user-card:hover {
            transform: translateY(-5px);
            border-color: #4cc9f0;
            box-shadow: 0 10px 30px rgba(76, 201, 240, 0.15);
        }
        
        .user-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: linear-gradient(90deg, #4cc9f0, #4361ee);
        }
        
        .user-icon {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: rgba(76, 201, 240, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 20px;
            border: 2px solid rgba(76, 201, 240, 0.3);
        }
        
        .user-icon i {
            font-size: 24px;
            color: #4cc9f0;
        }
        
        .user-card h3 {
            color: #4cc9f0;
            margin-bottom: 20px;
            font-size: 18px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .input-group {
            margin-bottom: 15px;
        }
        
        .input-group label {
            display: block;
            margin-bottom: 8px;
            color: rgba(255, 255, 255, 0.8);
            font-size: 14px;
            font-weight: 500;
        }
        
        .input-group input {
            width: 100%;
            padding: 12px 15px;
            background: rgba(255, 255, 255, 0.07);
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: 8px;
            color: white;
            font-size: 15px;
            transition: all 0.3s ease;
        }
        
        .input-group input:focus {
            outline: none;
            border-color: #4cc9f0;
            background: rgba(76, 201, 240, 0.1);
            box-shadow: 0 0 0 2px rgba(76, 201, 240, 0.2);
        }
        
        .setup-instructions {
            background: rgba(76, 201, 240, 0.1);
            border-radius: 15px;
            padding: 25px;
            margin: 30px 0;
            border: 1px solid rgba(76, 201, 240, 0.2);
        }
        
        .setup-instructions h4 {
            color: #4cc9f0;
            margin-bottom: 15px;
            font-size: 18px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .setup-instructions ul {
            list-style: none;
            padding-left: 0;
        }
        
        .setup-instructions li {
            padding: 8px 0;
            color: rgba(255, 255, 255, 0.8);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .setup-instructions li i {
            color: #4cc9f0;
            font-size: 14px;
        }
        
        .setup-actions {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 30px;
        }
        
        .setup-btn {
            padding: 15px 40px;
            background: linear-gradient(45deg, #4cc9f0, #4361ee);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
            box-shadow: 0 4px 15px rgba(76, 201, 240, 0.3);
        }
        
        .setup-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(76, 201, 240, 0.4);
            background: linear-gradient(45deg, #3ab0d6, #3a50d6);
        }
        
        .setup-btn:active {
            transform: translateY(-1px);
        }
        
        #setupError {
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid rgba(239, 68, 68, 0.3);
            border-radius: 8px;
            padding: 15px;
            margin: 20px 0;
            color: #ff6b6b;
            display: none;
        }
        
        .login-modal, .personal-login-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            z-index: 2000;
            display: none;
            align-items: center;
            justify-content: center;
        }
        
        .login-modal-content, .personal-login-content {
            background: var(--card-bg);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 40px;
            width: 90%;
            max-width: 450px;
            border: 1px solid rgba(76, 201, 240, 0.3);
            box-shadow: 0 0 30px rgba(76, 201, 240, 0.2);
            position: relative;
            overflow: hidden;
        }
        
        .login-header {
            text-align: center;
            margin-bottom: 30px;
            position: relative;
        }
        
        .login-header h2 {
            color: #4cc9f0;
            font-size: 24px;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .login-header p {
            color: rgba(255, 255, 255, 0.7);
            font-size: 14px;
        }
        
        .back-modal-btn {
            position: absolute;
            top: 0;
            right: 0;
            width: 36px;
            height: 36px;
            border-radius: 8px;
            background: rgba(67, 97, 238, 0.2);
            border: 1px solid rgba(67, 97, 238, 0.3);
            color: #4cc9f0;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            transition: all 0.3s ease;
            z-index: 10;
        }
        
        .back-modal-btn:hover {
            background: rgba(67, 97, 238, 0.3);
            transform: scale(1.1);
            box-shadow: 0 0 10px rgba(67, 97, 238, 0.4);
        }
        
        .login-form {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .form-input-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .form-input-group label {
            color: rgba(255, 255, 255, 0.9);
            font-weight: 500;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .form-input-group input {
            width: 100%;
            padding: 14px 16px;
            background: rgba(255, 255, 255, 0.08);
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: 8px;
            color: white;
            font-size: 15px;
            transition: all 0.3s ease;
        }
        
        .form-input-group input:focus {
            outline: none;
            border-color: #4cc9f0;
            background: rgba(76, 201, 240, 0.1);
            box-shadow: 0 0 0 2px rgba(76, 201, 240, 0.2);
        }
        
        .login-error {
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid rgba(239, 68, 68, 0.3);
            border-radius: 8px;
            padding: 12px;
            color: #ff6b6b;
            display: none;
            align-items: center;
            gap: 10px;
            font-size: 14px;
        }
        
        .login-btn {
            padding: 14px;
            background: linear-gradient(45deg, #4cc9f0, #4361ee);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin-top: 10px;
        }
        
        .login-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(76, 201, 240, 0.3);
            background: linear-gradient(45deg, #3ab0d6, #3a50d6);
        }
        
        .login-footer {
            text-align: center;
            margin-top: 25px;
            padding-top: 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            color: rgba(255, 255, 255, 0.7);
            font-size: 14px;
        }
        
        .switch-login-btn {
            background: transparent;
            border: 1px solid rgba(76, 201, 240, 0.3);
            color: #4cc9f0;
            padding: 10px;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
            margin-top: 10px;
            font-weight: 500;
        }
        
        .switch-login-btn:hover {
            background: rgba(76, 201, 240, 0.1);
            border-color: #4cc9f0;
        }
        
        .dashboard-container {
            display: flex;
            height: 100vh;
            max-height: 100vh;
            overflow: hidden;
        }
        
        .sidebar {
            width: var(--sidebar-width);
            background: rgba(20, 20, 40, 0.9);
            backdrop-filter: blur(10px);
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 15px 0;
            border-right: 1px solid rgba(255, 255, 255, 0.1);
            position: relative;
            z-index: 10;
        }
        
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            position: relative;
        }
        
        .content-area {
            flex: 1;
            overflow: auto;
            padding: 15px;
        }
        
        .profile-container {
            position: relative;
            width: 52px;
            height: 52px;
            border-radius: 50%;
            margin-bottom: 15px;
            cursor: pointer;
            overflow: hidden;
            background: linear-gradient(135deg, rgba(67, 97, 238, 0.3), rgba(76, 201, 240, 0.3));
            border: 2px solid rgba(76, 201, 240, 0.5);
            box-shadow: 0 4px 15px rgba(76, 201, 240, 0.2);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            aspect-ratio: 1/1;
        }
        
        .profile-container:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 20px rgba(76, 201, 240, 0.4);
            border-color: #4cc9f0;
        }
        
        .profile-container:active {
            transform: scale(0.98);
            transition: transform 0.1s;
        }
        
        .profile-image {
            width: 100%;
            height: 100%;
            object-fit: scale-down;
            transform: scale(1.1);
            background-color: rgba(30, 30, 46, 0.8);
            display: none;
        }
        
        .profile-placeholder {
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #4cc9f0;
            font-size: 20px;
        }
        
        .tap-counter {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85);
            border-radius: 50%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
            z-index: 2;
            aspect-ratio: 1/1;
        }
        
        .tap-counter.active {
            opacity: 1;
            visibility: visible;
        }
        
        .tap-counter-number {
            font-size: 28px;
            font-weight: 900;
            color: #4cc9f0;
            text-shadow: 0 0 10px rgba(76, 201, 240, 0.5);
            margin-bottom: 2px;
        }
        
        .tap-counter-text {
            font-size: 9px;
            color: rgba(255, 255, 255, 0.8);
            text-align: center;
            max-width: 80%;
            line-height: 1.2;
        }
        
        .modern-upload-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            z-index: 9999;
            display: none;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(10px);
            animation: fadeIn 0.3s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .modern-upload-content {
            background: linear-gradient(135deg, rgba(30, 30, 46, 0.95), rgba(20, 20, 40, 0.95));
            border-radius: 20px;
            padding: 30px;
            width: 90%;
            max-width: 400px;
            border: 1px solid rgba(76, 201, 240, 0.3);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            position: relative;
            overflow: hidden;
        }
        
        .upload-modal-header {
            text-align: center;
            margin-bottom: 25px;
        }
        
        .upload-modal-header h3 {
            color: #4cc9f0;
            font-size: 22px;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .upload-modal-header p {
            color: rgba(255, 255, 255, 0.7);
            font-size: 14px;
        }
        
        .upload-preview-container {
            width: 180px;
            height: 180px;
            margin: 0 auto 25px;
            border-radius: 50%;
            overflow: hidden;
            border: 3px solid rgba(76, 201, 240, 0.5);
            position: relative;
            background: rgba(255, 255, 255, 0.05);
            aspect-ratio: 1/1;
        }
        
        .upload-preview-image {
            width: 100%;
            height: 100%;
            object-fit: scale-down;
            transform: scale(1.05);
            background-color: rgba(30, 30, 46, 0.8);
            display: none;
        }
        
        .upload-placeholder {
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: rgba(255, 255, 255, 0.5);
            text-align: center;
        }
        
        .upload-placeholder i {
            font-size: 48px;
            margin-bottom: 10px;
            color: #4cc9f0;
        }
        
        .upload-actions {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-bottom: 20px;
        }
        
        .upload-action-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            padding: 14px;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
            font-size: 15px;
        }
        
        .upload-action-btn:active {
            transform: scale(0.98);
            transition: transform 0.1s;
        }
        
        .upload-btn-primary {
            background: linear-gradient(45deg, #4cc9f0, #4361ee);
            color: white;
            box-shadow: 0 4px 15px rgba(76, 201, 240, 0.3);
        }
        
        .upload-btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(76, 201, 240, 0.4);
            background: linear-gradient(45deg, #3ab0d6, #3a50d6);
        }
        
        .upload-btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .upload-btn-secondary:hover {
            background: rgba(255, 255, 255, 0.15);
            transform: translateY(-2px);
        }
        
        .upload-btn-cancel {
            background: rgba(239, 68, 68, 0.1);
            color: #ef4444;
            border: 1px solid rgba(239, 68, 68, 0.2);
        }
        
        .upload-btn-cancel:hover {
            background: rgba(239, 68, 68, 0.15);
        }
        
        .main-header {
            padding: 10px 20px;
            background: rgba(25, 25, 45, 0.9);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
            min-height: 50px;
            position: relative;
        }
        
        .header-title {
            font-weight: 700;
            color: #4cc9f0;
            text-shadow: 0 0 8px rgba(76, 201, 240, 0.5);
            font-size: calc(var(--font-size) * 1.1);
        }
        
        .header-actions {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .nav-item {
            width: 100%;
            display: flex;
            justify-content: center;
            padding: 12px 0;
            color: rgba(255, 255, 255, 0.6);
            cursor: pointer;
            transition: all 0.2s ease;
            position: relative;
            -webkit-tap-highlight-color: transparent;
        }
        
        .nav-item:hover {
            color: #4cc9f0;
            background: rgba(76, 201, 240, 0.1);
        }
        
        .nav-item:active {
            color: #4cc9f0;
            background: rgba(76, 201, 240, 0.25);
            transform: scale(0.95);
            transition: transform 0.1s, background 0.1s;
        }
        
        .nav-item.active {
            color: #4cc9f0;
            background: rgba(76, 201, 240, 0.15);
        }
        
        .nav-item.active::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            height: 100%;
            width: 3px;
            background: #4cc9f0;
        }
        
        .settings-btn {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            background: rgba(67, 97, 238, 0.2);
            border: 1px solid rgba(67, 97, 238, 0.3);
            color: #4cc9f0;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 15px 0;
            transition: all 0.3s ease;
            position: relative;
        }
        
        .settings-btn:hover {
            background: rgba(67, 97, 238, 0.3);
            transform: translateY(-2px);
        }
        
        .settings-btn:active {
            transform: scale(0.95);
            transition: transform 0.1s;
        }
        
        .settings-menu {
            position: absolute;
            left: calc(100% + 10px);
            top: 0;
            background: rgba(30, 30, 46, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 8px;
            min-width: 180px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.1);
            z-index: 1000;
            padding: 8px;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }
        
        .settings-btn:hover .settings-menu {
            opacity: 1;
            visibility: visible;
        }
        
        .settings-item {
            padding: 8px 12px;
            cursor: pointer;
            border-radius: 4px;
            font-size: calc(var(--font-size) * 0.9);
            color: var(--text-light);
            display: flex;
            align-items: center;
            gap: 8px;
            transition: background 0.3s ease;
        }
        
        .settings-item:active {
            background: rgba(76, 201, 240, 0.25);
            transform: scale(0.98);
            transition: transform 0.1s;
        }
        
        .settings-item:hover {
            background: rgba(76, 201, 240, 0.1);
        }
        
        .user-avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: linear-gradient(45deg, #4cc9f0, #4361ee);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: white;
            cursor: pointer;
            font-size: calc(var(--font-size) * 1);
            position: relative;
            z-index: 2;
            transition: all 0.2s ease;
            animation: rotateWF 8s linear infinite;
            box-shadow: 
                0 0 15px rgba(67, 97, 238, 0.6),
                0 0 30px rgba(76, 201, 240, 0.4),
                inset 0 0 10px rgba(255, 255, 255, 0.3);
            margin-top: 10px;
            aspect-ratio: 1/1;
        }
        
        .user-avatar:hover {
            transform: scale(1.1);
            animation-duration: 4s;
        }
        
        .user-avatar:active {
            transform: scale(0.95);
            transition: transform 0.1s;
        }
        
        @keyframes rotateWF {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .real-time-indicator {
            position: absolute;
            top: -2px;
            right: -2px;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background-color: #4cc9f0;
            border: 2px solid var(--card-bg);
            box-shadow: 0 0 8px #4cc9f0;
            animation: pulse 1s infinite;
            z-index: 3;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.5); opacity: 0.8; }
            100% { transform: scale(1); opacity: 1; }
        }
        
        .network-status-container {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 6px 12px;
            background: rgba(255, 255, 255, 0.08);
            border-radius: 10px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            min-width: 120px;
            backdrop-filter: blur(10px);
        }
        
        .network-status-container:hover {
            background: rgba(255, 255, 255, 0.12);
            transform: translateY(-1px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }
        
        .network-status-container:active {
            transform: scale(0.98);
            transition: transform 0.1s;
        }
        
        .network-status-container.analyzing {
            animation: analyzingPulse 1.5s infinite;
        }
        
        @keyframes analyzingPulse {
            0%, 100% { background: rgba(255, 255, 255, 0.08); }
            50% { background: rgba(76, 201, 240, 0.15); }
        }
        
        .network-status-container.offline {
            background: rgba(239, 68, 68, 0.08);
            border-color: rgba(239, 68, 68, 0.2);
        }
        
        .signal-strength {
            display: flex;
            align-items: flex-end;
            gap: 2px;
            height: 18px;
        }
        
        .signal-bar {
            width: 4px;
            background: var(--online);
            border-radius: 2px;
            transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .signal-bar:nth-child(1) { height: 6px; }
        .signal-bar:nth-child(2) { height: 9px; }
        .signal-bar:nth-child(3) { height: 12px; }
        .signal-bar:nth-child(4) { height: 15px; }
        .signal-bar:nth-child(5) { height: 18px; }
        
        .network-info {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            gap: 2px;
            flex: 1;
        }
        
        .network-type {
            font-size: calc(var(--font-size) * 0.65);
            font-weight: 700;
            color: rgba(255, 255, 255, 0.9);
            white-space: nowrap;
            letter-spacing: 0.5px;
        }
        
        .network-speed {
            font-size: calc(var(--font-size) * 0.75);
            font-weight: 800;
            color: #4cc9f0;
            text-shadow: 0 0 5px rgba(76, 201, 240, 0.3);
        }
        
        .network-icon {
            font-size: calc(var(--font-size) * 0.9);
            color: #4cc9f0;
            transition: all 0.3s ease;
        }
        
        .network-status-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: #4cc9f0;
            color: white;
            font-size: 10px;
            font-weight: 900;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 8px rgba(76, 201, 240, 0.5);
            animation: badgePulse 2s infinite;
        }
        
        @keyframes badgePulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        
        .dashboard-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 12px;
            height: 100%;
        }
        
        @media (min-width: 768px) {
            .dashboard-grid.overview-tab {
                grid-template-columns: 1fr 1fr;
                grid-template-rows: auto auto;
            }
            
            .dashboard-grid.overview-tab .project-progress {
                grid-column: span 2;
            }
        }
        
        .compact-card {
            background: var(--card-bg);
            backdrop-filter: blur(10px);
            border-radius: 10px;
            padding: 15px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.1);
            position: relative;
            overflow: hidden;
        }
        
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            padding-bottom: 8px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .card-title {
            font-size: calc(var(--font-size) * 1.1);
            font-weight: 700;
        }
        
        .card-meta {
            font-size: calc(var(--font-size) * 0.9);
            color: rgba(255, 255, 255, 0.7);
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .progress-bar {
            height: 6px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
            overflow: hidden;
            margin: 8px 0;
        }
        
        .progress {
            height: 100%;
            background: linear-gradient(90deg, #4cc9f0, #4361ee);
            border-radius: 3px;
            transition: width 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .compact-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
        }
        
        .compact-table tr {
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            transition: background 0.2s ease;
        }
        
        .compact-table tr:hover {
            background: rgba(255, 255, 255, 0.05);
        }
        
        .compact-table tr:active {
            background: rgba(76, 201, 240, 0.1);
            transition: background 0.1s;
        }
        
        .compact-table td {
            padding: 8px 5px;
            vertical-align: middle;
        }
        
        .text-truncate {
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 100px;
        }
        
        .text-right {
            text-align: right;
        }
        
        .status-indicator {
            display: inline-block;
            width: calc(var(--font-size) * 0.7);
            height: calc(var(--font-size) * 0.7);
            border-radius: 50%;
            margin-right: 5px;
        }
        
        .status-online { background-color: #4cc9f0; box-shadow: 0 0 5px #4cc9f0; }
        .status-away { background-color: #ff8c00; box-shadow: 0 0 5px #ff8c00; }
        .status-offline { background-color: rgba(255, 255, 255, 0.3); }
        .status-busy { background-color: #f72585; box-shadow: 0 0 5px #f72585; }
        
        .compact-checkbox {
            width: calc(var(--font-size) * 1.2);
            height: calc(var(--font-size) * 1.2);
            border-radius: 50%;
            border: 2px solid rgba(255, 255, 255, 0.3);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }
        
        .compact-checkbox.checked {
            background-color: #4cc9f0;
            border-color: #4cc9f0;
        }
        
        .compact-checkbox:active {
            transform: scale(0.9);
            transition: transform 0.1s;
        }
        
        .action-btn {
            width: calc(var(--font-size) * 1.8);
            height: calc(var(--font-size) * 1.8);
            border-radius: 4px;
            background: rgba(255, 255, 255, 0.1);
            border: none;
            color: white;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
            font-size: calc(var(--font-size) * 0.9);
        }
        
        .action-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: scale(1.1);
        }
        
        .action-btn:active {
            transform: scale(0.95);
            transition: transform 0.1s;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }
        
        .modal-content {
            background: var(--card-bg);
            backdrop-filter: blur(10px);
            border-radius: 10px;
            width: 90%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            padding: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .modal-title {
            font-weight: 700;
            color: #4cc9f0;
        }
        
        .form-group {
            margin-bottom: 12px;
        }
        
        .form-label {
            display: block;
            margin-bottom: 5px;
            color: rgba(255, 255, 255, 0.8);
            font-weight: 600;
        }
        
        .form-control {
            width: 100%;
            padding: 8px 10px;
            background: var(--data-bg);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 5px;
            color: white;
            transition: all 0.2s ease;
        }
        
        .form-control:focus {
            border-color: #4cc9f0;
            box-shadow: 0 0 0 2px rgba(76, 201, 240, 0.2);
        }
        
        .btn {
            padding: 6px 12px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s ease;
            display: inline-flex;
            align-items: center;
            gap: 5px;
            background: rgba(67, 97, 238, 0.2);
            color: white;
            border: 1px solid rgba(67, 97, 238, 0.3);
        }
        
        .btn:hover {
            background: rgba(67, 97, 238, 0.4);
            transform: translateY(-1px);
        }
        
        .btn:active {
            transform: scale(0.98);
            transition: transform 0.1s;
        }
        
        .btn-primary {
            background: rgba(67, 97, 238, 0.3);
            border: 1px solid rgba(67, 97, 238, 0.5);
        }
        
        .search-box {
            width: 100%;
            padding: 8px 12px;
            background: var(--data-bg);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 6px;
            color: white;
            margin-bottom: 10px;
            transition: all 0.2s ease;
        }
        
        .search-box:focus {
            border-color: #4cc9f0;
            box-shadow: 0 0 0 2px rgba(76, 201, 240, 0.2);
        }
        
        .notification {
            position: fixed;
            bottom: 10px;
            right: 10px;
            background: rgba(76, 201, 240, 0.9);
            color: white;
            padding: 10px 15px;
            border-radius: 6px;
            display: flex;
            align-items: center;
            gap: 8px;
            z-index: 100;
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.3s ease;
        }
        
        .notification.show {
            opacity: 1;
            transform: translateY(0);
        }
        
        .scrollable-content {
            max-height: 180px;
            overflow-y: auto;
            padding-right: 5px;
        }
        
        .empty-state {
            text-align: center;
            padding: 20px 10px;
            color: rgba(255, 255, 255, 0.5);
        }
        
        .flex-center {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .w-100 {
            width: 100%;
        }
        
        .bold-stats {
            font-weight: 700 !important;
        }
        
        .priority-badge {
            padding: 3px 8px;
            border-radius: 10px;
            font-size: calc(var(--font-size) * 0.8);
            font-weight: 700;
            display: inline-block;
        }
        
        .priority-high {
            background: rgba(247, 37, 133, 0.3);
            border: 1px solid rgba(247, 37, 133, 0.5);
        }
        
        .priority-medium {
            background: rgba(76, 201, 240, 0.3);
            border: 1px solid rgba(76, 201, 240, 0.5);
        }
        
        .priority-low {
            background: rgba(160, 160, 192, 0.3);
            border: 1px solid rgba(160, 160, 192, 0.5);
        }
        
        .online-badge {
            display: inline-block;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: calc(var(--font-size) * 0.7);
            font-weight: 700;
            margin-left: 5px;
        }
        
        .online-badge.online {
            background: rgba(76, 201, 240, 0.2);
            color: #4cc9f0;
        }
        
        .online-badge.offline {
            background: rgba(239, 68, 68, 0.2);
            color: #ef4444;
        }
        
        .personal-info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .info-item {
            background: var(--data-bg);
            border-radius: 8px;
            padding: 15px;
            border-left: 3px solid #4cc9f0;
        }
        
        .info-label {
            font-size: calc(var(--font-size) * 0.8);
            color: rgba(255, 255, 255, 0.7);
            margin-bottom: 5px;
        }
        
        .info-value {
            font-size: calc(var(--font-size) * 1.1);
            font-weight: 700;
            color: #4cc9f0;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .exit-modal-content {
            background: rgba(20, 20, 40, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 15px;
            width: 90%;
            max-width: 450px;
            max-height: 85vh;
            overflow-y: auto;
            padding: 30px;
            border: 1px solid rgba(239, 68, 68, 0.3);
            box-shadow: 0 0 40px rgba(239, 68, 68, 0.2);
            text-align: center;
            position: relative;
        }
        
        .exit-icon {
            font-size: 48px;
            color: #ef4444;
            margin-bottom: 15px;
            animation: pulseExit 2s ease infinite;
        }
        
        @keyframes pulseExit {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.1); opacity: 0.8; }
        }
        
        .exit-title {
            font-size: calc(var(--font-size) * 1.5);
            font-weight: 700;
            color: #ef4444;
            margin-bottom: 10px;
        }
        
        .exit-message {
            font-size: calc(var(--font-size) * 1.1);
            color: rgba(255, 255, 255, 0.9);
            margin-bottom: 20px;
            line-height: 1.5;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin: 20px 0;
        }
        
        .stat-box {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            padding: 15px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.2s ease;
        }
        
        .stat-box:hover {
            transform: translateY(-2px);
            background: rgba(255, 255, 255, 0.08);
            border-color: rgba(239, 68, 68, 0.3);
        }
        
        .stat-value {
            font-size: calc(var(--font-size) * 1.8);
            font-weight: 700;
            color: #4cc9f0;
            display: block;
            margin-bottom: 5px;
        }
        
        .stat-label {
            font-size: calc(var(--font-size) * 0.9);
            color: rgba(255, 255, 255, 0.7);
            font-weight: 600;
        }
        
        .exit-footer {
            margin-top: 25px;
            padding-top: 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            color: rgba(255, 255, 255, 0.7);
            font-size: calc(var(--font-size) * 0.9);
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
        }
        
        .quit-btn {
            background: linear-gradient(45deg, #ef4444, #dc2626);
            border: none;
            color: white;
            padding: 10px 20px;
            border-radius: 8px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 4px 15px rgba(239, 68, 68, 0.3);
        }
        
        .quit-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(239, 68, 68, 0.4);
            background: linear-gradient(45deg, #dc2626, #b91c1c);
        }
        
        .quit-btn:active {
            transform: scale(0.98);
            transition: transform 0.1s;
        }
        
        .countdown {
            font-size: calc(var(--font-size) * 1.1);
            font-weight: 700;
            color: #ef4444;
            margin-top: 10px;
        }
        
        body.font-small { --font-size: 12px; }
        body.font-medium { --font-size: 13px; }
        body.font-large { --font-size: 14px; }
        
        .clear-activity-btn {
            background: rgba(239, 68, 68, 0.2);
            border: 1px solid rgba(239, 68, 68, 0.3);
            color: #ef4444;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: calc(var(--font-size) * 0.8);
            cursor: pointer;
            transition: all 0.2s ease;
            display: inline-flex;
            align-items: center;
            gap: 3px;
        }
        
        .clear-activity-btn:hover {
            background: rgba(239, 68, 68, 0.3);
            transform: scale(1.05);
        }
        
        .clear-activity-btn:active {
            transform: scale(0.95);
            transition: transform 0.1s;
        }
        
        .clear-single-btn {
            background: transparent;
            border: none;
            color: rgba(239, 68, 68, 0.7);
            cursor: pointer;
            font-size: calc(var(--font-size) * 0.8);
            padding: 2px 5px;
            border-radius: 3px;
            transition: all 0.2s ease;
        }
        
        .clear-single-btn:hover {
            color: #ef4444;
            background: rgba(239, 68, 68, 0.1);
        }
        
        .clear-single-btn:active {
            transform: scale(0.9);
            transition: transform 0.1s;
        }
        
        .clear-personal-btn {
            background: transparent;
            border: 1px solid rgba(239, 68, 68, 0.3);
            color: #ef4444;
            font-size: calc(var(--font-size) * 0.7);
            padding: 2px 6px;
            border-radius: 3px;
            cursor: pointer;
            transition: all 0.2s ease;
            margin-left: 8px;
            display: inline-flex;
            align-items: center;
            gap: 3px;
        }
        
        .clear-personal-btn:hover {
            background: rgba(239, 68, 68, 0.1);
            border-color: #ef4444;
        }
        
        .clear-personal-btn:active {
            transform: scale(0.95);
            transition: transform 0.1s;
        }
        
        * {
            scrollbar-width: thin;
            scrollbar-color: rgba(76, 201, 240, 0.3) rgba(255, 255, 255, 0.05);
        }
        
        ::-webkit-scrollbar {
            width: 5px;
            height: 5px;
        }
        
        ::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 3px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: rgba(76, 201, 240, 0.3);
            border-radius: 3px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: rgba(76, 201, 240, 0.5);
        }
        
        .permission-hidden {
            display: none !important;
        }
        
        .role-badge {
            padding: 2px 8px;
            border-radius: 4px;
            font-size: calc(var(--font-size) * 0.7);
            font-weight: 700;
            margin-left: 5px;
        }
        
        .role-ceo {
            background: rgba(247, 37, 133, 0.2);
            color: #f72585;
            border: 1px solid rgba(247, 37, 133, 0.3);
        }
        
        .role-manager {
            background: rgba(76, 201, 240, 0.2);
            color: #4cc9f0;
            border: 1px solid rgba(76, 201, 240, 0.3);
        }
        
        .role-admin {
            background: rgba(67, 97, 238, 0.2);
            color: #4361ee;
            border: 1px solid rgba(67, 97, 238, 0.3);
        }
        
        .role-member {
            background: rgba(160, 160, 192, 0.2);
            color: #a0a0c0;
            border: 1px solid rgba(160, 160, 192, 0.3);
        }
        
        .task-status-control {
            display: flex;
            gap: 5px;
            margin-top: 5px;
        }
        
        .status-btn {
            padding: 2px 8px;
            border-radius: 3px;
            font-size: calc(var(--font-size) * 0.8);
            cursor: pointer;
            border: 1px solid transparent;
            transition: all 0.2s ease;
        }
        
        .status-btn:hover:not(:disabled) {
            transform: translateY(-1px);
        }
        
        .status-btn:active:not(:disabled) {
            transform: scale(0.95);
            transition: transform 0.1s;
        }
        
        .status-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .btn-complete {
            background: rgba(76, 201, 240, 0.2);
            color: #4cc9f0;
            border-color: rgba(76, 201, 240, 0.3);
        }
        
        .btn-complete:hover:not(:disabled) {
            background: rgba(76, 201, 240, 0.3);
        }
        
        .btn-mark-recent {
            background: rgba(67, 97, 238, 0.2);
            color: #4361ee;
            border-color: rgba(67, 97, 238, 0.3);
        }
        
        .btn-mark-recent:hover:not(:disabled) {
            background: rgba(67, 97, 238, 0.3);
        }
        
        .clear-completed-btn {
            background: rgba(247, 37, 133, 0.2);
            border: 1px solid rgba(247, 37, 133, 0.3);
            color: #f72585;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: calc(var(--font-size) * 0.8);
            cursor: pointer;
            transition: all 0.2s ease;
            display: inline-flex;
            align-items: center;
            gap: 3px;
        }
        
        .clear-completed-btn:hover {
            background: rgba(247, 37, 133, 0.3);
            transform: scale(1.05);
        }
        
        .clear-completed-btn:active {
            transform: scale(0.95);
            transition: transform 0.1s;
        }
        
        .add-person-btn {
            background: rgba(76, 201, 240, 0.2);
            border: 1px solid rgba(76, 201, 240, 0.3);
            color: #4cc9f0;
            padding: 6px 12px;
            border-radius: 6px;
            font-size: calc(var(--font-size) * 0.9);
            cursor: pointer;
            transition: all 0.2s ease;
            display: inline-flex;
            align-items: center;
            gap: 5px;
            font-weight: 600;
        }
        
        .add-person-btn:hover {
            background: rgba(76, 201, 240, 0.3);
            transform: translateY(-1px);
        }
        
        .add-person-btn:active {
            transform: scale(0.98);
            transition: transform 0.1s;
        }
        
        .add-btn {
            width: 32px;
            height: 32px;
            border-radius: 8px;
            background: linear-gradient(45deg, #4cc9f0, #4361ee);
            border: none;
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.2s ease;
            box-shadow: 0 2px 8px rgba(76, 201, 240, 0.3);
        }
        
        .add-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(76, 201, 240, 0.4);
        }
        
        .add-btn:active {
            transform: scale(0.95);
            transition: transform 0.1s;
        }
        
        .assigned-by {
            font-size: calc(var(--font-size) * 0.7);
            color: rgba(255, 255, 255, 0.6);
            margin-top: 2px;
            display: block;
        }
        
        .assigned-by.ceo {
            color: #f72585;
            font-weight: 600;
        }
        
        .assigned-by.manager {
            color: #4cc9f0;
            font-weight: 600;
        }
        
        .assigned-by.admin {
            color: #4361ee;
            font-weight: 600;
        }
        
        .assigned-by.member {
            color: #a0a0c0;
        }
        
        .quick-add-menu {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            display: flex;
            gap: 5px;
        }
        
        .add-menu-btn {
            padding: 8px 16px;
            background: linear-gradient(45deg, #4cc9f0, #4361ee);
            border: none;
            border-radius: 6px;
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 600;
            font-size: calc(var(--font-size) * 0.9);
            transition: all 0.2s ease;
            margin-left: 10px;
        }
        
        .add-menu-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(76, 201, 240, 0.3);
            background: linear-gradient(45deg, #3ab0d6, #3a50d6);
        }
        
        .add-menu-btn:active {
            transform: scale(0.98);
            transition: transform 0.1s;
        }
        
        .admin-menu {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .ceo-manager-menu {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .sync-status {
            position: fixed;
            bottom: 20px;
            left: 20px;
            background: rgba(30, 30, 46, 0.9);
            border-radius: 8px;
            padding: 8px 12px;
            font-size: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
            z-index: 100;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(76, 201, 240, 0.3);
            transition: all 0.3s ease;
        }
        
        .sync-status.syncing {
            background: rgba(76, 201, 240, 0.2);
            animation: syncPulse 1.5s infinite;
        }
        
        .sync-status.online {
            background: rgba(76, 201, 240, 0.2);
            border-color: #4cc9f0;
            color: #4cc9f0;
        }
        
        .sync-status.offline {
            background: rgba(239, 68, 68, 0.2);
            border-color: #ef4444;
            color: #ef4444;
        }
        
        @keyframes syncPulse {
            0%, 100% { background: rgba(76, 201, 240, 0.2); }
            50% { background: rgba(76, 201, 240, 0.4); }
        }
        
        .immediate-feedback {
            animation: feedback 0.3s ease;
        }
        
        @keyframes feedback {
            0% { transform: scale(1); }
            50% { transform: scale(1.02); }
            100% { transform: scale(1); }
        }
        
        .member-profile-image {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            object-fit: scale-down;
            transform: scale(1.05);
            background-color: rgba(30, 30, 46, 0.8);
            border: 2px solid #4cc9f0;
            display: none;
        }
        
        .member-profile-placeholder {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: linear-gradient(45deg, #4cc9f0, #4361ee);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 32px;
            color: white;
            margin: 0 auto 15px;
        }
        
        @media (max-width: 768px) {
            body {
                overflow-x: hidden;
                width: 100vw;
            }
            
            .dashboard-container {
                flex-direction: column;
                height: auto;
                min-height: 100vh;
            }
            
            .sidebar {
                width: 100%;
                height: 60px;
                flex-direction: row;
                justify-content: space-around;
                padding: 0 10px;
                position: fixed;
                bottom: 0;
                top: auto;
                border-right: none;
                border-top: 1px solid rgba(255, 255, 255, 0.1);
                z-index: 100;
            }
            
            .profile-container {
                width: 45px;
                height: 45px;
                margin-bottom: 0;
                margin-right: auto;
            }
            
            .user-avatar {
                width: 45px;
                height: 45px;
                margin-top: 0;
                margin-left: auto;
            }
            
            .settings-btn {
                margin: 0;
                width: 45px;
                height: 45px;
            }
            
            .settings-menu {
                left: 0;
                top: auto;
                bottom: 60px;
            }
            
            .nav-item {
                padding: 0;
                width: 45px;
                height: 45px;
                display: flex;
                align-items: center;
                justify-content: center;
            }
            
            .nav-item:active {
                transform: scale(0.9);
                transition: transform 0.1s;
            }
            
            .nav-item.active::before {
                width: 100%;
                height: 3px;
                top: auto;
                bottom: 0;
                left: 0;
            }
            
            .main-content {
                margin-bottom: 60px;
                height: calc(100vh - 60px);
            }
            
            .main-header {
                flex-direction: column;
                align-items: flex-start;
                padding: 10px;
                gap: 10px;
            }
            
            .header-title {
                font-size: calc(var(--font-size) * 1.2);
                width: 100%;
                text-align: center;
            }
            
            .header-actions {
                flex-direction: column;
                width: 100%;
                gap: 8px;
            }
            
            .admin-menu, .ceo-manager-menu {
                width: 100%;
                justify-content: center;
                gap: 5px;
                flex-wrap: wrap;
            }
            
            .add-menu-btn {
                margin-left: 0;
                padding: 8px 12px;
                font-size: calc(var(--font-size) * 0.8);
            }
            
            .user-avatar, .settings-btn, .nav-item, .profile-container {
                aspect-ratio: 1/1;
            }
            
            .quick-add-menu {
                position: relative;
                right: auto;
                top: auto;
                transform: none;
                justify-content: center;
                width: 100%;
                margin-top: 10px;
            }
            
            .add-btn {
                width: 40px;
                height: 40px;
            }
            
            .network-status-container {
                min-width: 100%;
                justify-content: space-between;
            }
            
            .content-area {
                padding: 10px;
                overflow-y: auto;
            }
            
            .dashboard-grid {
                display: flex;
                flex-direction: column;
                gap: 15px;
            }
            
            .dashboard-grid.overview-tab .project-progress {
                order: 1;
            }
            
            .dashboard-grid.overview-tab .recent-tasks {
                order: 2;
            }
            
            .dashboard-grid.overview-tab .team-status {
                order: 3;
            }
            
            .compact-card {
                width: 100%;
                margin: 0;
                flex-basis: 100%;
            }
            
            .card-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }
            
            .card-meta {
                width: 100%;
                justify-content: space-between;
            }
            
            .setup-grid {
                display: flex;
                flex-direction: column;
                gap: 20px;
            }
            
            .user-card {
                width: 100%;
            }
            
            .personal-info-grid, .stats-grid {
                display: flex;
                flex-direction: column;
                gap: 10px;
            }
            
            .info-item, .stat-box {
                width: 100%;
            }
            
            .ceo-setup-content,
            .login-modal-content,
            .personal-login-content,
            .modern-upload-content,
            .modal-content,
            .exit-modal-content {
                width: 95vw;
                max-width: 95vw;
                padding: 20px;
                margin: 10px;
            }
            
            .upload-preview-container {
                width: 150px;
                height: 150px;
            }
            
            table {
                display: block;
                overflow-x: auto;
                white-space: nowrap;
                -webkit-overflow-scrolling: touch;
            }
            
            .compact-table td {
                padding: 6px 3px;
            }
            
            .text-truncate {
                max-width: 80px;
            }
            
            .sync-status {
                bottom: auto;
                top: 10px;
                left: 10px;
                width: 40px;
                height: 40px;
                padding: 0;
                display: flex;
                align-items: center;
                justify-content: center;
                border-radius: 50%;
                background: rgba(30, 30, 46, 0.9);
                z-index: 1000;
            }
            
            .sync-status span {
                display: none;
            }
            
            .sync-status i {
                font-size: 18px;
                margin: 0;
            }
            
            .sync-status.online {
                background: rgba(76, 201, 240, 0.2);
                border-color: #4cc9f0;
                color: #4cc9f0;
            }
            
            .sync-status.offline {
                background: rgba(239, 68, 68, 0.2);
                border-color: #ef4444;
                color: #ef4444;
            }
            
            .notification {
                left: 10px;
                right: 10px;
                width: calc(100% - 20px);
            }
            
            .input-group input,
            .form-input-group input,
            .form-control,
            .search-box {
                font-size: 16px;
                padding: 12px;
            }
            
            .setup-btn, .login-btn, .upload-action-btn, .quit-btn {
                padding: 15px;
                width: 100%;
                justify-content: center;
            }
            
            .setup-actions {
                flex-direction: column;
            }
            
            .modal-header {
                flex-direction: column;
                gap: 10px;
            }
            
            .action-btn {
                width: 40px;
                height: 40px;
            }
        }
        
        @media (max-width: 480px) {
            .header-title {
                font-size: calc(var(--font-size) * 1.1);
            }
            
            .user-card {
                padding: 15px;
            }
            
            .user-icon {
                width: 50px;
                height: 50px;
            }
            
            .upload-preview-container {
                width: 120px;
                height: 120px;
            }
            
            .compact-card {
                padding: 12px;
            }
            
            .progress-bar {
                height: 5px;
            }
            
            .tap-counter-number {
                font-size: 22px;
            }
            
            .tap-counter-text {
                font-size: 8px;
            }
        }
        
        @media (max-width: 320px) {
            .sidebar {
                height: 50px;
                padding: 0 5px;
            }
            
            .profile-container,
            .user-avatar,
            .settings-btn,
            .nav-item {
                width: 40px;
                height: 40px;
            }
            
            .main-content {
                margin-bottom: 50px;
                height: calc(100vh - 50px);
            }
            
            .header-title {
                font-size: calc(var(--font-size) * 1);
            }
            
            .add-menu-btn {
                padding: 6px 10px;
                font-size: calc(var(--font-size) * 0.7);
            }
            
            .compact-table td {
                padding: 4px 2px;
                font-size: calc(var(--font-size) * 0.9);
            }
            
            .text-truncate {
                max-width: 60px;
            }
        }
        
        @supports (-webkit-touch-callout: none) {
            .dashboard-container {
                height: -webkit-fill-available;
            }
        }
    </style>
</head>
<body class="font-medium">
    <div class="ceo-setup-modal" id="ceoSetupModal">
        <div class="ceo-setup-content">
            <div class="ceo-header">
                <h1><i class="fas fa-users"></i> WillFort GSquad Initial Setup</h1>
                <p>CEO: Set up all usernames and passwords for your team (First time setup)</p>
            </div>
            
            <div class="setup-progress" id="setupProgress">
                <div class="progress-step">
                    <div class="step-indicator" id="step1">1</div>
                    <div class="step-label">CEO</div>
                </div>
                <div class="progress-step">
                    <div class="step-indicator" id="step2">2</div>
                    <div class="step-label">Admin</div>
                </div>
                <div class="progress-step">
                    <div class="step-indicator" id="step3">3</div>
                    <div class="step-label">Manager</div>
                </div>
                <div class="progress-step">
                    <div class="step-indicator" id="step4">4</div>
                    <div class="step-label">Member</div>
                </div>
            </div>
            
            <div class="setup-grid">
                <div class="user-card">
                    <div class="user-icon">
                        <i class="fas fa-crown"></i>
                    </div>
                    <h3><i class="fas fa-crown"></i> CEO Master Account</h3>
                    <div class="input-group">
                        <label>CEO Username</label>
                        <input type="text" id="ceoUsername" placeholder="Choose CEO username" required>
                        <div class="validation-message" id="ceoUsernameValidation"></div>
                    </div>
                    <div class="input-group">
                        <label>CEO Password</label>
                        <input type="password" id="ceoPassword" placeholder="Set CEO password" required>
                        <div class="validation-message" id="ceoPasswordValidation"></div>
                    </div>
                    <div class="input-group">
                        <label>Confirm Password</label>
                        <input type="password" id="ceoConfirmPassword" placeholder="Confirm password" required>
                        <div class="validation-message" id="ceoConfirmValidation"></div>
                    </div>
                </div>
                
                <div class="user-card">
                    <div class="user-icon">
                        <i class="fas fa-user-shield"></i>
                    </div>
                    <h3><i class="fas fa-user-shield"></i> Admin Account</h3>
                    <div class="input-group">
                        <label>Admin Username</label>
                        <input type="text" id="adminUsername" placeholder="Choose admin username" required>
                        <div class="validation-message" id="adminUsernameValidation"></div>
                    </div>
                    <div class="input-group">
                        <label>Admin Password</label>
                        <input type="password" id="adminPassword" placeholder="Set admin password" required>
                        <div class="validation-message" id="adminPasswordValidation"></div>
                    </div>
                    <div class="input-group">
                        <label>Confirm Password</label>
                        <input type="password" id="adminConfirmPassword" placeholder="Confirm password" required>
                        <div class="validation-message" id="adminConfirmValidation"></div>
                    </div>
                </div>
                
                <div class="user-card">
                    <div class="user-icon">
                        <i class="fas fa-user-tie"></i>
                    </div>
                    <h3><i class="fas fa-user-tie"></i> Manager Account</h3>
                    <div class="input-group">
                        <label>Manager Username</label>
                        <input type="text" id="managerUsername" placeholder="Choose manager username" required>
                        <div class="validation-message" id="managerUsernameValidation"></div>
                    </div>
                    <div class="input-group">
                        <label>Manager Password</label>
                        <input type="password" id="managerPassword" placeholder="Set manager password" required>
                        <div class="validation-message" id="managerPasswordValidation"></div>
                    </div>
                    <div class="input-group">
                        <label>Confirm Password</label>
                        <input type="password" id="managerConfirmPassword" placeholder="Confirm password" required>
                        <div class="validation-message" id="managerConfirmValidation"></div>
                    </div>
                </div>
                
                <div class="user-card">
                    <div class="user-icon">
                        <i class="fas fa-user"></i>
                    </div>
                    <h3><i class="fas fa-user"></i> Team Member 1</h3>
                    <div class="input-group">
                        <label>Member Username</label>
                        <input type="text" id="member1Username" placeholder="Choose member username" required>
                        <div class="validation-message" id="member1UsernameValidation"></div>
                    </div>
                    <div class="input-group">
                        <label>Member Password</label>
                        <input type="password" id="member1Password" placeholder="Set member password" required>
                        <div class="validation-message" id="member1PasswordValidation"></div>
                    </div>
                    <div class="input-group">
                        <label>Confirm Password</label>
                        <input type="password" id="member1ConfirmPassword" placeholder="Confirm password" required>
                        <div class="validation-message" id="member1ConfirmValidation"></div>
                    </div>
                </div>
            </div>
            
            <div class="setup-instructions">
                <h4><i class="fas fa-info-circle"></i> Setup Instructions:</h4>
                <ul>
                    <li><i class="fas fa-check-circle"></i> All usernames must be unique</li>
                    <li><i class="fas fa-check-circle"></i> Passwords must be at least 6 characters</li>
                    <li><i class="fas fa-check-circle"></i> These credentials will be used for initial login</li>
                    <li><i class="fas fa-check-circle"></i> CEO can add more members after setup</li>
                    <li><i class="fas fa-check-circle"></i> Each user can change their password after first login</li>
                    <li><i class="fas fa-check-circle"></i> Make sure to remember your CEO credentials!</li>
                </ul>
            </div>
            
            <div id="setupError" style="display: none;"></div>
            
            <div class="setup-actions">
                <button onclick="saveAllCredentials()" class="setup-btn">
                    <i class="fas fa-save"></i> Complete Setup & Start System
                </button>
            </div>
        </div>
    </div>

    <div class="modern-upload-modal" id="modernUploadModal">
        <div class="modern-upload-content">
            <div class="upload-modal-header">
                <h3><i class="fas fa-user-circle"></i> Update Your Profile Picture</h3>
                <p>Upload a personal photo that only you can see</p>
            </div>
            
            <div class="upload-preview-container">
                <img class="upload-preview-image" id="modernPreviewImage" src="" alt="Preview">
                <div class="upload-placeholder" id="uploadPlaceholder">
                    <i class="fas fa-user"></i>
                    <span>Preview will appear here</span>
                </div>
            </div>
            
            <div class="upload-actions">
                <button class="upload-action-btn upload-btn-primary" onclick="triggerFileInput()">
                    <i class="fas fa-folder-open"></i> Choose Photo
                </button>
                <button class="upload-action-btn upload-btn-primary" onclick="saveModernProfileImage()" id="saveModernImageBtn" style="display: none;">
                    <i class="fas fa-save"></i> Save Profile Picture
                </button>
                <button class="upload-action-btn upload-btn-cancel" onclick="cancelModernUpload()">
                    <i class="fas fa-times"></i> Cancel
                </button>
            </div>
            
            <div style="text-align: center; margin-top: 15px;">
                <small style="color: rgba(255, 255, 255, 0.5);">
                    <i class="fas fa-info-circle"></i> Your image is stored privately in your browser and only you can see it
                </small>
            </div>
        </div>
    </div>

    <input type="file" id="modernProfileImageInput" accept="image/*" style="display: none;">

    <div class="login-modal" id="loginModal">
        <div class="login-modal-content">
            <div class="login-header">
                <button class="back-modal-btn" onclick="goBackToPreviousPage()" title="Go Back to Previous Page">
                    <i class="fas fa-arrow-left"></i>
                </button>
                <h2><i class="fas fa-users"></i> WillFort GSquad</h2>
                <p>Administrative Login</p>
            </div>
            
            <div class="login-form">
                <div class="form-input-group">
                    <label><i class="fas fa-user"></i> Username</label>
                    <input type="text" id="adminLoginUser" placeholder="Enter your username" required>
                </div>
                
                <div class="form-input-group">
                    <label><i class="fas fa-lock"></i> Password</label>
                    <input type="password" id="adminLoginPass" placeholder="Enter your password" required>
                </div>
                
                <div class="login-error" id="adminLoginError">
                    <i class="fas fa-exclamation-circle"></i>
                    <span id="adminLoginErrorText"></span>
                </div>
                
                <button onclick="adminLogin()" class="login-btn">
                    <i class="fas fa-sign-in-alt"></i> Admin Login
                </button>
            </div>
            
            <div class="login-footer">
                <p>Team Members Login:</p>
                <button onclick="showPersonalLogin()" class="switch-login-btn">
                    <i class="fas fa-user"></i> Personal Login
                </button>
            </div>
        </div>
    </div>

    <div class="personal-login-modal" id="personalLoginModal">
        <div class="personal-login-content">
            <div class="login-header">
                <button class="back-modal-btn" onclick="goBackToPreviousPage()" title="Go Back to Previous Page">
                    <i class="fas fa-arrow-left"></i>
                </button>
                <h2><i class="fas fa-user-circle"></i> Personal Login</h2>
                <p>Use your Username & Password</p>
            </div>
            
            <div class="login-form">
                <div class="form-input-group">
                    <label><i class="fas fa-user"></i> Username</label>
                    <input type="text" id="personalUsername" placeholder="Enter your username" required>
                </div>
                
                <div class="form-input-group">
                    <label><i class="fas fa-lock"></i> Password</label>
                    <input type="password" id="personalPassword" placeholder="Enter your password" required>
                </div>
                
                <div class="login-error" id="personalLoginError">
                    <i class="fas fa-exclamation-circle"></i>
                    <span id="personalLoginErrorText"></span>
                </div>
                
                <button onclick="personalLogin()" class="login-btn">
                    <i class="fas fa-sign-in-alt"></i> Login to My Account
                </button>
            </div>
            
            <div class="login-footer">
                <button onclick="showAdminLogin()" class="switch-login-btn">
                    <i class="fas fa-shield-alt"></i> Admin Login
                </button>
            </div>
        </div>
    </div>

    <div class="dashboard-container" id="mainDashboard" style="display: none;">
        <div class="sidebar">
            <div class="profile-container" id="profileContainer">
                <img class="profile-image" id="profileImage" src="" alt="Profile">
                <div class="profile-placeholder" id="profilePlaceholder">
                    <i class="fas fa-user"></i>
                </div>
                <div class="tap-counter" id="tapCounter">
                    <div class="tap-counter-number" id="tapCounterNumber">5</div>
                    <div class="tap-counter-text">Tap to upload</div>
                </div>
            </div>
            
            <div class="settings-btn">
                <i class="fas fa-cog"></i>
                <div class="settings-menu">
                    <div class="settings-item" onclick="toggleFontSize('small')">
                        <i class="fas fa-font"></i> Small Font
                    </div>
                    <div class="settings-item" onclick="toggleFontSize('medium')">
                        <i class="fas fa-font"></i> Medium Font
                    </div>
                    <div class="settings-item" onclick="toggleFontSize('large')">
                        <i class="fas fa-font"></i> Large Font
                    </div>
                    <div class="settings-item" onclick="showChangePasswordModal()">
                        <i class="fas fa-key"></i> Change Password
                    </div>
                </div>
            </div>
            
            <div class="nav-item active" data-tab="overview">
                <i class="fas fa-chart-pie"></i>
            </div>
            
            <div class="nav-item" data-tab="tasks">
                <i class="fas fa-tasks"></i>
            </div>
            
            <div class="nav-item" data-tab="team">
                <i class="fas fa-user-friends"></i>
            </div>
            
            <div class="nav-item" data-tab="activity">
                <i class="fas fa-history"></i>
            </div>
            
            <div class="user-avatar" title="Exit Dashboard" onclick="showExitModal()">
                <i class="fas fa-sign-out-alt"></i>
                <div class="real-time-indicator"></div>
            </div>
        </div>
        
        <div class="main-content">
            <div class="main-header">
                <div class="header-title" id="headerTitle">
                    <i class="fas fa-chart-pie"></i> WillFort GSquad Dashboard
                    <span class="online-badge online" id="headerOnlineStatus">Live</span>
                </div>
                <div class="header-actions">
                    <div id="userRoleDisplay" style="margin-right: 15px; font-weight: 600; color: #4cc9f0;">
                        <span id="currentUserName"></span>
                        <span class="role-badge" id="currentUserRoleBadge"></span>
                    </div>
                    
                    <div class="admin-menu" id="adminMenu" style="display: none;">
                        <button class="add-menu-btn" onclick="showAddPersonModal()">
                            <i class="fas fa-user-plus"></i> Add Member
                        </button>
                    </div>
                    
                    <div class="ceo-manager-menu" id="ceoManagerMenu" style="display: none;">
                        <button class="add-menu-btn" onclick="showTaskModal()">
                            <i class="fas fa-tasks"></i> Add Task
                        </button>
                    </div>
                    
                    <div class="quick-add-menu">
                        <button class="add-btn permission-hidden" id="quickAddTaskBtn" onclick="showTaskModal()" title="Add Task">
                            <i class="fas fa-plus"></i>
                        </button>
                        <button class="add-btn permission-hidden" id="quickAddMemberBtn" onclick="showAddPersonModal()" title="Add Member">
                            <i class="fas fa-user-plus"></i>
                        </button>
                    </div>
                    
                    <div class="network-status-container" id="networkStatusContainer">
                        <div class="signal-strength" id="signalStrength">
                            <div class="signal-bar"></div>
                            <div class="signal-bar"></div>
                            <div class="signal-bar"></div>
                            <div class="signal-bar"></div>
                            <div class="signal-bar"></div>
                        </div>
                        <div class="network-info">
                            <div class="network-type" id="networkType">Analyzing...</div>
                            <div class="network-speed" id="networkSpeed">-- Mbps</div>
                        </div>
                        <i class="fas fa-wifi network-icon" id="networkIcon"></i>
                        <div class="network-status-badge" id="networkBadge">
                            <i class="fas fa-bolt"></i>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="content-area" id="contentArea">
                <div class="dashboard-grid overview-tab" id="overviewTab">
                    <div class="compact-card project-progress">
                        <div class="card-header">
                            <div class="card-title">Project Progress</div>
                            <div class="card-meta" id="progressText">0% Complete</div>
                        </div>
                        <div class="progress-bar">
                            <div class="progress" id="progressBar" style="width: 0%"></div>
                        </div>
                        <div style="display: flex; justify-content: space-between; margin-top: 10px;">
                            <div><i class="fas fa-check-circle"></i> <span id="completedCount" class="bold-stats">0</span> completed</div>
                            <div><i class="fas fa-clock"></i> <span id="remainingCount" class="bold-stats">0</span> remaining</div>
                            <div><i class="fas fa-users"></i> <span id="teamCount" class="bold-stats">0</span> members</div>
                        </div>
                    </div>
                    
                    <div class="compact-card recent-tasks">
                        <div class="card-header">
                            <div class="card-title">Recent Tasks</div>
                            <div class="card-meta">Last 3</div>
                        </div>
                        <input type="text" class="search-box" placeholder="Search tasks..." onkeyup="searchRecentTasks(this.value)">
                        <div class="scrollable-content">
                            <table class="compact-table" id="recentTasksTable">
                                <tr><td colspan="4" class="empty-state">No tasks yet</td></tr>
                            </table>
                        </div>
                    </div>
                    
                    <div class="compact-card team-status">
                        <div class="card-header">
                            <div class="card-title">Team Status</div>
                            <div class="card-meta" id="onlineCount">0 online</div>
                        </div>
                        <input type="text" class="search-box" placeholder="Search team..." onkeyup="searchTeamStatus(this.value)">
                        <div class="scrollable-content">
                            <table class="compact-table" id="teamStatusTable">
                                <tr><td colspan="3" class="empty-state">No team members yet</td></tr>
                            </table>
                        </div>
                    </div>
                </div>
                
                <div class="dashboard-grid tasks-tab" id="tasksTab" style="display: none;">
                    <div class="compact-card all-tasks">
                        <div class="card-header">
                            <div class="card-title">All Tasks</div>
                            <div class="card-meta">
                                <span id="totalTasks">0 tasks</span>
                                <button class="add-person-btn permission-hidden" id="addTaskBtn" onclick="showTaskModal()">
                                    <i class="fas fa-plus"></i> Add Task
                                </button>
                                <button class="clear-completed-btn permission-hidden" id="clearCompletedBtn" onclick="clearCompletedTasks()">
                                    <i class="fas fa-trash"></i> Clear Completed
                                </button>
                            </div>
                        </div>
                        <input type="text" class="search-box" placeholder="Search all tasks..." onkeyup="searchAllTasks(this.value)">
                        <div class="scrollable-content" style="max-height: 250px;">
                            <table class="compact-table w-100" id="allTasksTable">
                                <tr><td colspan="5" class="empty-state">No tasks yet</td></tr>
                            </table>
                        </div>
                    </div>
                </div>
                
                <div class="dashboard-grid team-tab" id="teamTab" style="display: none;">
                    <div class="compact-card team-members">
                        <div class="card-header">
                            <div class="card-title">Team Members</div>
                            <div class="card-meta">
                                <span id="membersCount">0 members</span>
                                <button class="add-person-btn permission-hidden" id="addPersonBtn" onclick="showAddPersonModal()">
                                    <i class="fas fa-user-plus"></i> Add Person
                                </button>
                            </div>
                        </div>
                        <input type="text" class="search-box" placeholder="Search members..." onkeyup="searchMembers(this.value)">
                        <div class="scrollable-content" style="max-height: 250px;">
                            <table class="compact-table w-100" id="teamMembersTable">
                                <tr><td colspan="6" class="empty-state">No members yet</td></tr>
                            </table>
                        </div>
                    </div>
                </div>
                
                <div class="dashboard-grid activity-tab" id="activityTab" style="display: none;">
                    <div class="compact-card recent-activity">
                        <div class="card-header">
                            <div class="card-title">Recent Activity</div>
                            <div class="card-meta">
                                <span id="activityCount">0 activities</span>
                                <button class="clear-activity-btn permission-hidden" id="clearActivitiesBtn" onclick="clearAllActivities()" title="Clear all activities">
                                    <i class="fas fa-trash"></i> Clear All
                                </button>
                            </div>
                        </div>
                        <input type="text" class="search-box" placeholder="Search activity..." onkeyup="searchActivity(this.value)">
                        <div class="scrollable-content" style="max-height: 250px;">
                            <table class="compact-table w-100" id="activityTable">
                                <tr><td colspan="3" class="empty-state">No activity yet</td></tr>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="dashboard-container" id="personalDashboard" style="display: none;">
        <div class="sidebar">
            <div class="profile-container" id="personalProfileContainer">
                <img class="profile-image" id="personalProfileImage" src="" alt="Profile">
                <div class="profile-placeholder" id="personalProfilePlaceholder">
                    <i class="fas fa-user"></i>
                </div>
                <div class="tap-counter" id="personalTapCounter">
                    <div class="tap-counter-number" id="personalTapCounterNumber">5</div>
                    <div class="tap-counter-text">Tap to upload</div>
                </div>
            </div>
            
            <div class="settings-btn">
                <i class="fas fa-cog"></i>
                <div class="settings-menu">
                    <div class="settings-item" onclick="toggleFontSize('small')">
                        <i class="fas fa-font"></i> Small Font
                    </div>
                    <div class="settings-item" onclick="toggleFontSize('medium')">
                        <i class="fas fa-font"></i> Medium Font
                    </div>
                    <div class="settings-item" onclick="toggleFontSize('large')">
                        <i class="fas fa-font"></i> Large Font
                    </div>
                    <div class="settings-item" onclick="showChangePasswordModal()">
                        <i class="fas fa-key"></i> Change Password
                    </div>
                </div>
            </div>
            
            <div class="nav-item active" data-tab="mypersonal">
                <i class="fas fa-user-circle"></i>
            </div>
            
            <div class="nav-item" data-tab="mytasks">
                <i class="fas fa-tasks"></i>
            </div>
            
            <div class="nav-item" data-tab="myactivity">
                <i class="fas fa-history"></i>
            </div>
            
            <div class="user-avatar" title="Logout" onclick="logout()">
                <i class="fas fa-sign-out-alt"></i>
                <div class="real-time-indicator"></div>
            </div>
        </div>
        
        <div class="main-content">
            <div class="main-header">
                <div class="header-title" id="personalHeaderTitle">
                    <i class="fas fa-user-circle"></i> My Personal Dashboard
                    <span class="online-badge online">Personal</span>
                </div>
                <div class="header-actions">
                    <div id="personalUserDisplay" style="margin-right: 15px; font-weight: 600; color: #4cc9f0;">
                        <span id="personalUserName"></span>
                        <span class="role-badge" id="personalUserRoleBadge"></span>
                    </div>
                </div>
            </div>
            
            <div class="content-area" id="personalContentArea">
                <div class="dashboard-grid mypersonal-tab" id="mypersonalTab">
                    <div class="compact-card">
                        <div class="card-header">
                            <div class="card-title">My Personal Information</div>
                            <div class="card-meta">Confidential</div>
                        </div>
                        <div class="personal-info-grid" id="personalInfoGrid">
                        </div>
                    </div>
                    
                    <div class="compact-card">
                        <div class="card-header">
                            <div class="card-title">Login Credentials</div>
                            <div class="card-meta">Keep Secure</div>
                        </div>
                        <div class="personal-info-grid">
                            <div class="info-item">
                                <div class="info-label">Username</div>
                                <div class="info-value" id="personalUsernameDisplay"></div>
                            </div>
                            <div class="info-item">
                                <div class="info-label">Login Status</div>
                                <div class="info-value" id="personalLoginStatus">Active</div>
                            </div>
                            <div class="info-item">
                                <div class="info-label">Last Login</div>
                                <div class="info-value" id="personalLastLogin"></div>
                            </div>
                            <div class="info-item">
                                <div class="info-label">Identity Number</div>
                                <div class="info-value" id="personalIdDisplay"></div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="dashboard-grid mytasks-tab" id="mytasksTab" style="display: none;">
                    <div class="compact-card">
                        <div class="card-header">
                            <div class="card-title">My Tasks</div>
                            <div class="card-meta" id="personalTaskCount">0 tasks</div>
                        </div>
                        <div class="scrollable-content" style="max-height: 300px;">
                            <table class="compact-table w-100" id="personalTasksTable">
                                <tr><td colspan="4" class="empty-state">No tasks assigned</td></tr>
                            </table>
                        </div>
                    </div>
                </div>
                
                <div class="dashboard-grid myactivity-tab" id="myactivityTab" style="display: none;">
                    <div class="compact-card">
                        <div class="card-header">
                            <div class="card-title">My Activity Log</div>
                            <div class="card-meta">
                                Personal
                                <button class="clear-personal-btn" onclick="clearPersonalActivities()" title="Clear my activity">
                                    <i class="fas fa-trash"></i> Clear
                                </button>
                            </div>
                        </div>
                        <div class="scrollable-content" style="max-height: 300px;">
                            <table class="compact-table w-100" id="personalActivityTable">
                                <tr><td colspan="2" class="empty-state">No activity yet</td></tr>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="modal" id="taskModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title" id="taskModalTitle">New Task</div>
                <button class="action-btn close-modal">&times;</button>
            </div>
            <form id="taskForm">
                <div class="form-group">
                    <label class="form-label">Title</label>
                    <input type="text" class="form-control" id="taskTitle" placeholder="Task title" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Assign To</label>
                    <select class="form-control" id="taskAssignee" required>
                        <option value="">Select member</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Due Date</label>
                    <input type="date" class="form-control" id="taskDueDate" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Priority</label>
                    <select class="form-control" id="taskPriority" required>
                        <option value="low">Low</option>
                        <option value="medium" selected>Medium</option>
                        <option value="high">High</option>
                    </select>
                </div>
                <div style="display: flex; gap: 8px; justify-content: flex-end; margin-top: 15px;">
                    <button type="button" class="btn close-modal">Cancel</button>
                    <button type="submit" class="btn btn-primary">Save</button>
                </div>
            </form>
        </div>
    </div>
    
    <div class="modal" id="addPersonModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">Add New Person</div>
                <button class="action-btn close-modal">&times;</button>
            </div>
            <form id="addPersonForm">
                <div class="form-group">
                    <label class="form-label">Full Name</label>
                    <input type="text" class="form-control" id="addPersonFullName" placeholder="Full name" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Username</label>
                    <input type="text" class="form-control" id="addPersonUsername" placeholder="Choose username" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Set Password</label>
                    <input type="password" class="form-control" id="addPersonPassword" placeholder="Set password" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Confirm Password</label>
                    <input type="password" class="form-control" id="addPersonConfirmPassword" placeholder="Confirm password" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Role</label>
                    <select class="form-control" id="addPersonRole" required>
                        <option value="">Select role</option>
                        <option value="member">Team Member</option>
                        <option value="admin">Admin</option>
                        <option value="manager">Manager</option>
                        <option value="ceo">CEO</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Email Address</label>
                    <input type="email" class="form-control" id="addPersonEmail" placeholder="Email" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Phone Number</label>
                    <input type="tel" class="form-control" id="addPersonPhone" placeholder="Phone" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Department</label>
                    <input type="text" class="form-control" id="addPersonDepartment" placeholder="Department" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Employee ID</label>
                    <input type="text" class="form-control" id="addPersonEmployeeId" placeholder="Auto-generated" readonly>
                </div>
                <div id="addPersonError" style="color: #ff6b6b; text-align: center; margin-bottom: 10px; display: none;"></div>
                <div style="display: flex; gap: 8px; justify-content: flex-end; margin-top: 15px;">
                    <button type="button" class="btn close-modal">Cancel</button>
                    <button type="submit" class="btn btn-primary">Add Person</button>
                </div>
            </form>
        </div>
    </div>
    
    <div class="modal" id="changePasswordModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">Change Password</div>
                <button class="action-btn close-modal">&times;</button>
            </div>
            <form id="changePasswordForm">
                <div class="form-group">
                    <label class="form-label">Current Password</label>
                    <input type="password" class="form-control" id="currentPassword" placeholder="Enter current password" required>
                </div>
                <div class="form-group">
                    <label class="form-label">New Password</label>
                    <input type="password" class="form-control" id="newPassword" placeholder="Enter new password" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Confirm New Password</label>
                    <input type="password" class="form-control" id="confirmNewPassword" placeholder="Confirm new password" required>
                </div>
                <div id="changePasswordError" style="color: #ff6b6b; text-align: center; margin-bottom: 10px; display: none;"></div>
                <div style="display: flex; gap: 8px; justify-content: flex-end; margin-top: 15px;">
                    <button type="button" class="btn close-modal">Cancel</button>
                    <button type="submit" class="btn btn-primary">Change Password</button>
                </div>
            </form>
        </div>
    </div>
    
    <div class="modal" id="viewMemberModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">Member Details</div>
                <button class="action-btn close-modal">&times;</button>
            </div>
            <div id="memberDetailsContent">
            </div>
            <button onclick="closeModal('viewMemberModal')" style="width: 100%; padding: 10px; margin-top: 15px; background: #666; color: white; border: none; border-radius: 6px; cursor: pointer;">
                Close
            </button>
        </div>
    </div>
    
    <div class="modal" id="editTaskModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">Edit Task</div>
                <button class="action-btn close-modal">&times;</button>
            </div>
            <form id="editTaskForm">
                <input type="hidden" id="editTaskId">
                <div class="form-group">
                    <label class="form-label">Title</label>
                    <input type="text" class="form-control" id="editTaskTitle" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Status</label>
                    <select class="form-control" id="editTaskStatus">
                        <option value="pending">Pending</option>
                        <option value="in-progress">In Progress</option>
                        <option value="completed">Completed</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Priority</label>
                    <select class="form-control" id="editTaskPriority">
                        <option value="low">Low</option>
                        <option value="medium">Medium</option>
                        <option value="high">High</option>
                    </select>
                </div>
                <div style="display: flex; gap: 8px; justify-content: flex-end; margin-top: 15px;">
                    <button type="button" class="btn close-modal">Cancel</button>
                    <button type="submit" class="btn btn-primary">Save Changes</button>
                </div>
            </form>
        </div>
    </div>
    
    <div class="modal" id="editMemberModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">Edit Member</div>
                <button class="action-btn close-modal">&times;</button>
            </div>
            <form id="editMemberForm">
                <input type="hidden" id="editMemberId">
                <div class="form-group">
                    <label class="form-label">Full Name</label>
                    <input type="text" class="form-control" id="editMemberFullName" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Username</label>
                    <input type="text" class="form-control" id="editMemberUsername" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Email</label>
                    <input type="email" class="form-control" id="editMemberEmail" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Role</label>
                    <select class="form-control" id="editMemberRole" required>
                        <option value="member">Team Member</option>
                        <option value="admin">Admin</option>
                        <option value="manager">Manager</option>
                        <option value="ceo">CEO</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Department</label>
                    <input type="text" class="form-control" id="editMemberDepartment" required>
                </div>
                <div id="editMemberError" style="color: #ff6b6b; text-align: center; margin-bottom: 10px; display: none;"></div>
                <div style="display: flex; gap: 8px; justify-content: flex-end; margin-top: 15px;">
                    <button type="button" class="btn close-modal">Cancel</button>
                    <button type="submit" class="btn btn-primary">Save Changes</button>
                </div>
            </form>
        </div>
    </div>
    
    <div class="modal" id="exitModal">
        <div class="exit-modal-content">
            <div class="exit-icon">
                <i class="fas fa-sign-out-alt"></i>
            </div>
            <div class="exit-title">Exit WillFort GSquad?</div>
            <div class="exit-message">
                You are about to log out of the system. Make sure you have saved all your work.
            </div>
            
            <div class="stats-grid">
                <div class="stat-box">
                    <span class="stat-value" id="exitTaskCount">0</span>
                    <span class="stat-label">Your Tasks</span>
                </div>
                <div class="stat-box">
                    <span class="stat-value" id="exitOnlineCount">0</span>
                    <span class="stat-label">Online Now</span>
                </div>
                <div class="stat-box">
                    <span class="stat-value" id="exitCompleted">0</span>
                    <span class="stat-label">Completed</span>
                </div>
                <div class="stat-box">
                    <span class="stat-value" id="exitActivity">0</span>
                    <span class="stat-label">Activities</span>
                </div>
            </div>
            
            <div class="exit-footer">
                <div>Clicking "Quit" will log you out and clear your session.</div>
                <button class="quit-btn" onclick="logout()">
                    <i class="fas fa-power-off"></i> Quit Dashboard
                </button>
                <div class="countdown" id="countdownTimer">Auto logout in: 60s</div>
            </div>
        </div>
    </div>
    
    <div class="notification" id="notification">
        <i class="fas fa-check-circle"></i>
        <span id="notificationText">Operation successful</span>
    </div>

    <div class="sync-status" id="syncStatus">
        <i class="fas fa-sync-alt"></i>
        <span id="syncStatusText">Syncing...</span>
    </div>

    <script>
        let currentUser = null;
        let currentRole = null;
        let currentUserId = null;
        let tasks = [];
        let teamMembers = [];
        let activities = [];
        let isPersonalMode = false;
        let networkStatusInterval;
        let countdownInterval;
        let secondsRemaining = 60;
        let lastActivityCheck = Date.now();
        let tapCounters = {};
        let tapTimeouts = {};
        let networkHistory = [];
        let imageCache = new Map();
        let db = null;
        let isOnline = navigator.onLine;
        let syncInterval = null;
        let realTimeInterval = null;
        let serverSimulation = {
            connected: false,
            pendingSync: false,
            lastSync: null,
            queue: []
        };

        const RoleHierarchy = {
            'ceo': 4,
            'manager': 3,
            'admin': 2,
            'member': 1
        };

        const PermissionMatrix = {
            canAddTask: (role) => role === 'ceo' || role === 'manager',
            canEditTask: (role) => role === 'ceo' || role === 'manager',
            canDeleteTask: (role) => role === 'ceo' || role === 'manager',
            canMarkTaskComplete: (role) => role === 'manager',
            canMarkTaskRecent: (role) => role === 'manager',
            canViewTasks: (role) => true,
            
            canAddPerson: (role) => role === 'ceo' || role === 'admin' || role === 'manager',
            canEditPerson: (role) => role === 'ceo' || role === 'admin',
            canDeletePerson: (role) => role === 'ceo',
            canPromotePerson: (role) => role === 'ceo',
            canViewPeople: (role) => true,
            
            canClearActivities: (role) => role === 'manager',
            canClearCompletedTasks: (role) => role === 'ceo' || role === 'manager',
            canViewActivities: (role) => true,
            
            canUpdateProgress: (role) => role === 'ceo' || role === 'manager',
            canViewProgress: (role) => true
        };

        function hasPermission(permissionName) {
            if (!currentRole) return false;
            return PermissionMatrix[permissionName](currentRole);
        }

        function goBackToPreviousPage() {
            window.history.back();
        }

        document.addEventListener('DOMContentLoaded', function() {
            if (!localStorage.getItem('ceoSetupCompleted')) {
                document.getElementById('ceoSetupModal').style.display = 'flex';
                initSetupValidation();
            } else {
                showAdminLogin();
            }
            
            initIndexedDB();
            initEventListeners();
            setupAdvancedNetworkMonitoring();
            setupActivityMonitoring();
            checkStoredSession();
            startRealTimeProcessing();
            
            initTapCounters();
            
            window.addEventListener('online', handleNetworkStatusChange);
            window.addEventListener('offline', handleNetworkStatusChange);
            
            updateSyncButtonStatus();
        });

        function initSetupValidation() {
            const inputs = document.querySelectorAll('#ceoSetupModal input');
            inputs.forEach(input => {
                input.addEventListener('input', function() {
                    validateSetupField(this);
                    updateSetupProgress();
                });
                input.addEventListener('blur', function() {
                    validateSetupField(this);
                });
            });
        }

        function validateSetupField(input) {
            const id = input.id;
            const value = input.value.trim();
            const validationDiv = document.getElementById(id + 'Validation');
            
            input.classList.remove('input-filled', 'input-error');
            
            if (!validationDiv) return;
            
            if (value.length === 0) {
                validationDiv.textContent = '';
                validationDiv.className = 'validation-message';
                return;
            }
            
            let isValid = true;
            let message = '';
            
            if (id.includes('Username')) {
                if (value.length < 3) {
                    isValid = false;
                    message = 'Username must be at least 3 characters';
                } else if (!/^[a-zA-Z0-9_]+$/.test(value)) {
                    isValid = false;
                    message = 'Only letters, numbers and underscore allowed';
                } else {
                    const allUsernames = [
                        document.getElementById('ceoUsername').value,
                        document.getElementById('adminUsername').value,
                        document.getElementById('managerUsername').value,
                        document.getElementById('member1Username').value
                    ].filter(v => v.trim().length > 0);
                    
                    const duplicates = allUsernames.filter((username, index) => 
                        allUsernames.indexOf(username) !== index && username === value
                    );
                    
                    if (duplicates.length > 0) {
                        isValid = false;
                        message = 'Username already taken';
                    } else {
                        message = '✓ Valid username';
                    }
                }
            } else if (id.includes('Password')) {
                if (value.length < 6) {
                    isValid = false;
                    message = 'Password must be at least 6 characters';
                } else {
                    message = '✓ Valid password';
                }
            } else if (id.includes('Confirm')) {
                const passwordId = id.replace('Confirm', '');
                const passwordInput = document.getElementById(passwordId);
                if (passwordInput && passwordInput.value !== value) {
                    isValid = false;
                    message = 'Passwords do not match';
                } else if (passwordInput && passwordInput.value.length > 0) {
                    message = '✓ Passwords match';
                }
            }
            
            if (isValid && value.length > 0) {
                input.classList.add('input-filled');
                validationDiv.textContent = message;
                validationDiv.className = 'validation-message';
            } else if (!isValid && value.length > 0) {
                input.classList.add('input-error');
                validationDiv.textContent = message;
                validationDiv.className = 'validation-message validation-error';
            } else {
                validationDiv.textContent = '';
                validationDiv.className = 'validation-message';
            }
        }

        function updateSetupProgress() {
            const steps = ['ceo', 'admin', 'manager', 'member1'];
            let completedSteps = 0;
            
            steps.forEach((step, index) => {
                const username = document.getElementById(step + 'Username').value.trim();
                const password = document.getElementById(step + 'Password').value;
                const confirm = document.getElementById(step + 'ConfirmPassword').value;
                
                const stepIndicator = document.getElementById('step' + (index + 1));
                
                if (username && password && confirm && password === confirm && password.length >= 6) {
                    stepIndicator.classList.add('completed');
                    completedSteps++;
                } else {
                    stepIndicator.classList.remove('completed');
                }
            });
            
            const progress = Math.round((completedSteps / steps.length) * 100);
            const setupBtn = document.querySelector('.setup-btn');
            if (setupBtn) {
                if (completedSteps === steps.length) {
                    setupBtn.innerHTML = '<i class="fas fa-rocket"></i> Complete Setup & Launch System';
                    setupBtn.style.background = 'linear-gradient(45deg, #43a047, #2e7d32)';
                } else {
                    setupBtn.innerHTML = '<i class="fas fa-save"></i> Complete Setup & Start System';
                    setupBtn.style.background = 'linear-gradient(45deg, #4cc9f0, #4361ee)';
                }
            }
        }

        function handleNetworkStatusChange() {
            const wasOnline = isOnline;
            isOnline = navigator.onLine;
            updateNetworkUIRealTime();
            updateHeaderOnlineStatus();
            updateSyncButtonStatus();
            
            if (!wasOnline && isOnline) {
                showNotification('Network connection restored', 'success');
                startAutoSync();
                processMediateData();
            } else if (wasOnline && !isOnline) {
                if (networkStatusInterval) {
                    clearInterval(networkStatusInterval);
                }
                if (syncInterval) {
                    clearInterval(syncInterval);
                }
                showNotification('No network connection', 'error');
            }
        }

        function updateSyncButtonStatus() {
            const syncStatus = document.getElementById('syncStatus');
            if (!syncStatus) return;
            
            if (isOnline) {
                syncStatus.classList.remove('offline');
                syncStatus.classList.add('online');
                document.getElementById('syncStatusText').textContent = 'Connected';
            } else {
                syncStatus.classList.remove('online');
                syncStatus.classList.add('offline');
                document.getElementById('syncStatusText').textContent = 'Offline';
            }
        }

        function updateHeaderOnlineStatus() {
            const headerOnlineStatus = document.getElementById('headerOnlineStatus');
            if (headerOnlineStatus) {
                if (isOnline) {
                    headerOnlineStatus.textContent = 'Live';
                    headerOnlineStatus.className = 'online-badge online';
                } else {
                    headerOnlineStatus.textContent = 'Offline';
                    headerOnlineStatus.className = 'online-badge offline';
                }
            }
        }

        function updateNetworkUIRealTime() {
            const networkContainer = document.getElementById('networkStatusContainer');
            const networkType = document.getElementById('networkType');
            const networkSpeed = document.getElementById('networkSpeed');
            const networkIcon = document.getElementById('networkIcon');
            const signalBars = document.querySelectorAll('.signal-bar');
            const networkBadge = document.getElementById('networkBadge');
            
            if (isOnline) {
                networkContainer.classList.remove('offline');
                networkType.textContent = 'Analyzing...';
                networkSpeed.textContent = '-- Mbps';
                networkIcon.className = 'fas fa-wifi network-icon';
                networkIcon.style.color = '#4cc9f0';
                
                signalBars.forEach((bar, index) => {
                    if (index < 5) {
                        bar.style.background = '#4cc9f0';
                        bar.style.boxShadow = '0 0 4px #4cc9f0';
                    }
                });
                
                if (networkBadge) {
                    networkBadge.style.display = 'flex';
                    networkBadge.style.background = '#4cc9f0';
                }
            } else {
                networkContainer.classList.add('offline');
                networkType.textContent = 'Offline';
                networkSpeed.textContent = 'No Connection';
                networkIcon.className = 'fas fa-wifi-slash network-icon';
                networkIcon.style.color = '#ef4444';
                
                signalBars.forEach(bar => {
                    bar.style.background = '#ef4444';
                    bar.style.boxShadow = '0 0 4px #ef4444';
                });
                
                if (networkBadge) {
                    networkBadge.style.display = 'none';
                }
            }
        }

        function initTapCounters() {
            tapCounters['main'] = { count: 0, timeout: null };
            tapCounters['personal'] = { count: 0, timeout: null };
        }

        function initIndexedDB() {
            const request = indexedDB.open('WillFortGSquadDB', 7);
            
            request.onerror = function(event) {
                loadFromLocalStorage();
            };
            
            request.onsuccess = function(event) {
                db = event.target.result;
                loadFromIndexedDB();
            };
            
            request.onupgradeneeded = function(event) {
                db = event.target.result;
                
                if (!db.objectStoreNames.contains('teamMembers')) {
                    const teamStore = db.createObjectStore('teamMembers', { keyPath: 'id' });
                    teamStore.createIndex('username', 'username', { unique: true });
                }
                
                if (!db.objectStoreNames.contains('tasks')) {
                    db.createObjectStore('tasks', { keyPath: 'id' });
                }
                
                if (!db.objectStoreNames.contains('activities')) {
                    db.createObjectStore('activities', { keyPath: 'id' });
                }
                
                if (!db.objectStoreNames.contains('userProfileImages')) {
                    const imageStore = db.createObjectStore('userProfileImages', { keyPath: 'userId' });
                    imageStore.createIndex('userId', 'userId', { unique: true });
                }
                
                if (!db.objectStoreNames.contains('networkHistory')) {
                    db.createObjectStore('networkHistory', { keyPath: 'timestamp' });
                }
                
                if (!db.objectStoreNames.contains('largeFiles')) {
                    const fileStore = db.createObjectStore('largeFiles', { keyPath: 'id' });
                    fileStore.createIndex('userId', 'userId');
                    fileStore.createIndex('type', 'type');
                }
                
                if (!db.objectStoreNames.contains('serverSyncQueue')) {
                    const syncStore = db.createObjectStore('serverSyncQueue', { keyPath: 'id' });
                    syncStore.createIndex('type', 'type');
                    syncStore.createIndex('timestamp', 'timestamp');
                }
                
                if (!db.objectStoreNames.contains('realTimeUpdates')) {
                    db.createObjectStore('realTimeUpdates', { keyPath: 'timestamp' });
                }
                
                if (!db.objectStoreNames.contains('offlineStorage')) {
                    const offlineStore = db.createObjectStore('offlineStorage', { 
                        keyPath: 'id',
                        autoIncrement: true 
                    });
                    offlineStore.createIndex('type', 'type');
                    offlineStore.createIndex('timestamp', 'timestamp');
                }
            };
        }

        function saveToIndexedDB() {
            if (!db) return;
            
            const transaction = db.transaction(['teamMembers', 'tasks', 'activities', 'serverSyncQueue'], 'readwrite');
            
            const teamStore = transaction.objectStore('teamMembers');
            const taskStore = transaction.objectStore('tasks');
            const activityStore = transaction.objectStore('activities');
            const syncStore = transaction.objectStore('serverSyncQueue');
            
            teamMembers.forEach(member => {
                teamStore.put(member);
                
                if (isOnline) {
                    const syncRecord = {
                        id: generateId(),
                        type: 'teamMember',
                        action: 'update',
                        data: member,
                        timestamp: new Date().toISOString(),
                        synced: false
                    };
                    syncStore.put(syncRecord);
                }
            });
            
            tasks.forEach(task => {
                taskStore.put(task);
                
                if (isOnline) {
                    const syncRecord = {
                        id: generateId(),
                        type: 'task',
                        action: 'update',
                        data: task,
                        timestamp: new Date().toISOString(),
                        synced: false
                    };
                    syncStore.put(syncRecord);
                }
            });
            
            activities.forEach(activity => {
                activityStore.put(activity);
            });
        }

        function loadFromIndexedDB() {
            if (!db) {
                loadFromLocalStorage();
                return;
            }
            
            const transaction = db.transaction(['teamMembers', 'tasks', 'activities', 'userProfileImages', 'serverSyncQueue'], 'readonly');
            
            const teamStore = transaction.objectStore('teamMembers');
            const taskStore = transaction.objectStore('tasks');
            const activityStore = transaction.objectStore('activities');
            const imageStore = transaction.objectStore('userProfileImages');
            const syncStore = transaction.objectStore('serverSyncQueue');
            
            const teamRequest = teamStore.getAll();
            const taskRequest = taskStore.getAll();
            const activityRequest = activityStore.getAll();
            const syncRequest = syncStore.getAll();
            
            teamRequest.onsuccess = function() {
                teamMembers = teamRequest.result || [];
                if (teamMembers.length === 0) {
                    loadFromLocalStorage();
                }
            };
            
            taskRequest.onsuccess = function() {
                tasks = taskRequest.result || [];
            };
            
            activityRequest.onsuccess = function() {
                activities = activityRequest.result || [];
            };
            
            syncRequest.onsuccess = function() {
                serverSimulation.queue = syncRequest.result || [];
                if (serverSimulation.queue.length > 0 && isOnline) {
                    startAutoSync();
                }
            };
        }

        function loadFromLocalStorage() {
            const savedTasks = localStorage.getItem('gSquadTasks');
            const savedTeam = localStorage.getItem('gSquadTeam');
            const savedActivities = localStorage.getItem('gSquadActivities');
            
            if (savedTasks) tasks = JSON.parse(savedTasks);
            if (savedTeam) teamMembers = JSON.parse(savedTeam);
            if (savedActivities) activities = JSON.parse(savedActivities);
            
            if (teamMembers.length === 0) {
                const defaultCEO = {
                    id: generateId(),
                    username: 'ceo',
                    password: 'ceo123',
                    fullName: 'Chief Executive Officer',
                    role: 'ceo',
                    email: 'ceo@willfort.com',
                    phone: '+1 (555) CEO-1234',
                    department: 'Executive',
                    status: 'online',
                    lastLogin: new Date().toISOString(),
                    joinDate: new Date().toISOString(),
                    employeeId: 'WF-001',
                    createdBy: 'system'
                };
                teamMembers.push(defaultCEO);
                saveToIndexedDB();
            }
        }

        function loadUserProfileImage(userId) {
            if (!db) return Promise.resolve(null);
            
            return new Promise((resolve, reject) => {
                const transaction = db.transaction(['userProfileImages'], 'readonly');
                const imageStore = transaction.objectStore('userProfileImages');
                const request = imageStore.get(userId);
                
                request.onsuccess = function() {
                    if (request.result) {
                        imageCache.set(userId, request.result.imageData);
                        resolve(request.result.imageData);
                    } else {
                        resolve(null);
                    }
                };
                
                request.onerror = function() {
                    reject(request.error);
                };
            });
        }

        function updateProfileImageDisplay(userId) {
            const imageData = imageCache.get(userId);
            
            if (userId === currentUserId) {
                const profileImage = document.getElementById('profileImage');
                const personalProfileImage = document.getElementById('personalProfileImage');
                const profilePlaceholder = document.getElementById('profilePlaceholder');
                const personalProfilePlaceholder = document.getElementById('personalProfilePlaceholder');
                
                if (profileImage && imageData) {
                    profileImage.src = imageData;
                    profileImage.style.display = 'block';
                    if (profilePlaceholder) profilePlaceholder.style.display = 'none';
                } else if (profileImage) {
                    profileImage.style.display = 'none';
                    if (profilePlaceholder) profilePlaceholder.style.display = 'flex';
                }
                
                if (personalProfileImage && imageData) {
                    personalProfileImage.src = imageData;
                    personalProfileImage.style.display = 'block';
                    if (personalProfilePlaceholder) personalProfilePlaceholder.style.display = 'none';
                } else if (personalProfileImage) {
                    personalProfileImage.style.display = 'none';
                    if (personalProfilePlaceholder) personalProfilePlaceholder.style.display = 'flex';
                }
            }
        }

        function saveUserProfileImageToDB(userId, imageData) {
            imageCache.set(userId, imageData);
            
            if (!db) {
                localStorage.setItem(`user_profile_image_${userId}`, imageData);
                updateProfileImageDisplay(userId);
                return Promise.resolve();
            }
            
            return new Promise((resolve, reject) => {
                const transaction = db.transaction(['userProfileImages', 'largeFiles', 'serverSyncQueue', 'offlineStorage'], 'readwrite');
                const imageStore = transaction.objectStore('userProfileImages');
                const fileStore = transaction.objectStore('largeFiles');
                const syncStore = transaction.objectStore('serverSyncQueue');
                const offlineStore = transaction.objectStore('offlineStorage');
                
                const imageRecord = {
                    userId: userId,
                    imageData: imageData,
                    timestamp: new Date().toISOString(),
                    updated: new Date().toISOString()
                };
                
                const request = imageStore.put(imageRecord);
                
                const fileRecord = {
                    id: generateId(),
                    userId: userId,
                    type: 'user_profile_image',
                    data: imageData,
                    size: imageData.length,
                    timestamp: new Date().toISOString(),
                    compressed: false
                };
                
                fileStore.put(fileRecord);
                
                if (imageData.length > 1024 * 1024) {
                    const offlineRecord = {
                        type: 'large_file',
                        fileType: 'profile_image',
                        userId: userId,
                        data: imageData,
                        size: imageData.length,
                        timestamp: new Date().toISOString(),
                        synced: false
                    };
                    offlineStore.add(offlineRecord);
                }
                
                if (isOnline) {
                    const syncRecord = {
                        id: generateId(),
                        type: 'profileImage',
                        action: 'update',
                        data: {
                            userId: userId,
                            size: imageData.length,
                            timestamp: new Date().toISOString()
                        },
                        timestamp: new Date().toISOString(),
                        synced: false
                    };
                    syncStore.put(syncRecord);
                }
                
                transaction.oncomplete = function() {
                    updateProfileImageDisplay(userId);
                    resolve();
                };
                
                transaction.onerror = function() {
                    reject(transaction.error);
                };
            });
        }

        function handleProfileTap(containerType = 'main') {
            const counter = tapCounters[containerType];
            
            if (counter.timeout) {
                clearTimeout(counter.timeout);
            }
            
            counter.count++;
            
            const tapCounterElement = document.getElementById(containerType === 'main' ? 'tapCounter' : 'personalTapCounter');
            const tapCounterNumber = document.getElementById(containerType === 'main' ? 'tapCounterNumber' : 'personalTapCounterNumber');
            
            if (tapCounterElement) {
                tapCounterElement.classList.add('active');
                tapCounterNumber.textContent = 5 - counter.count;
                
                const profileContainer = document.getElementById(containerType === 'main' ? 'profileContainer' : 'personalProfileContainer');
                if (profileContainer) {
                    profileContainer.classList.add('immediate-feedback');
                    setTimeout(() => {
                        profileContainer.classList.remove('immediate-feedback');
                    }, 300);
                }
            }
            
            counter.timeout = setTimeout(() => {
                counter.count = 0;
                if (tapCounterElement) {
                    tapCounterElement.classList.remove('active');
                }
            }, 2000);
            
            if (counter.count >= 5) {
                clearTimeout(counter.timeout);
                counter.count = 0;
                showModernUploadModal();
            }
        }

        function showModernUploadModal() {
            document.getElementById('modernUploadModal').style.display = 'flex';
            document.getElementById('saveModernImageBtn').style.display = 'none';
            document.getElementById('uploadPlaceholder').style.display = 'flex';
            document.getElementById('modernPreviewImage').style.display = 'none';
            
            document.getElementById('tapCounter').classList.remove('active');
            document.getElementById('personalTapCounter').classList.remove('active');
            
            loadUserProfileImage(currentUserId).then(imageData => {
                if (imageData) {
                    displayImagePreview(imageData);
                }
            });
        }

        function triggerFileInput() {
            document.getElementById('modernProfileImageInput').click();
            
            document.getElementById('modernProfileImageInput').onchange = function(event) {
                const file = event.target.files[0];
                if (file) {
                    if (!file.type.match('image.*')) {
                        showNotification('Please select an image file', 'error');
                        return;
                    }
                    
                    if (file.size > 100 * 1024 * 1024) {
                        showNotification('File size too large. Maximum 100MB allowed.', 'error');
                        return;
                    }
                    
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        const imageUrl = e.target.result;
                        displayImagePreview(imageUrl);
                        
                        setTimeout(() => {
                            saveImageToIndexedDB(imageUrl);
                        }, 1000);
                    };
                    
                    reader.onerror = function() {
                        showNotification('Error reading file', 'error');
                    };
                    
                    try {
                        reader.readAsDataURL(file);
                    } catch (error) {
                        showNotification('Error processing image: ' + error.message, 'error');
                    }
                }
            };
        }

        function displayImagePreview(imageUrl) {
            const previewImage = document.getElementById('modernPreviewImage');
            const placeholder = document.getElementById('uploadPlaceholder');
            
            previewImage.src = imageUrl;
            previewImage.style.display = 'block';
            placeholder.style.display = 'none';
            document.getElementById('saveModernImageBtn').style.display = 'block';
        }

        function saveImageToIndexedDB(imageUrl) {
            saveUserProfileImageToDB(currentUserId, imageUrl)
                .then(() => {
                    document.getElementById('modernUploadModal').style.display = 'none';
                    showNotification('Your profile picture saved successfully! Only you can see it.');
                })
                .catch(error => {
                    showNotification('Error saving profile picture', 'error');
                });
        }

        function saveModernProfileImage() {
            const previewImage = document.getElementById('modernPreviewImage');
            if (previewImage.src) {
                saveImageToIndexedDB(previewImage.src);
            }
        }

        function cancelModernUpload() {
            document.getElementById('modernUploadModal').style.display = 'none';
            resetTapCounters();
        }

        function resetTapCounters() {
            for (const key in tapCounters) {
                tapCounters[key].count = 0;
                if (tapCounters[key].timeout) {
                    clearTimeout(tapCounters[key].timeout);
                }
            }
            
            const tapCounter = document.getElementById('tapCounter');
            const personalTapCounter = document.getElementById('personalTapCounter');
            
            if (tapCounter) tapCounter.classList.remove('active');
            if (personalTapCounter) personalTapCounter.classList.remove('active');
        }

        function setupAdvancedNetworkMonitoring() {
            if (!isOnline) {
                updateNetworkUIRealTime();
                return;
            }
            
            updateAdvancedNetworkStatus();
            
            networkStatusInterval = setInterval(() => {
                if (isOnline) {
                    updateAdvancedNetworkStatus();
                    trackNetworkPerformance();
                } else {
                    updateNetworkUIRealTime();
                }
            }, 3000);
            
            setInterval(() => {
                if (isOnline) {
                    storeNetworkHistory();
                }
            }, 60000);
        }

        async function updateAdvancedNetworkStatus() {
            if (!isOnline) {
                updateNetworkUIRealTime();
                return;
            }
            
            const networkContainer = document.getElementById('networkStatusContainer');
            networkContainer.classList.add('analyzing');
            
            try {
                const connection = navigator.connection || navigator.mozConnection || navigator.webkitConnection;
                let networkType = 'Unknown';
                let effectiveType = '4g';
                let rtt = 50;
                let downlink = 10;
                
                if (connection) {
                    networkType = connection.type || 'Unknown';
                    effectiveType = connection.effectiveType || '4g';
                    rtt = connection.rtt || 50;
                    downlink = connection.downlink || 10;
                    
                    updateNetworkUI(networkType, effectiveType, downlink, rtt);
                } else {
                    simulateRealisticNetwork();
                }
                
                updateNetworkBadge();
                
            } catch (error) {
                simulateRealisticNetwork();
            }
            
            setTimeout(() => {
                networkContainer.classList.remove('analyzing');
            }, 500);
        }

        function updateNetworkUI(networkType, effectiveType, downlink, rtt) {
            const typeMap = {
                'slow-2g': '2G',
                '2g': '2G',
                '3g': '3G',
                '4g': '4G',
                '5g': '5G'
            };
            
            const displayType = typeMap[effectiveType] || '4G';
            const speed = downlink.toFixed(1);
            const latency = rtt;
            
            document.getElementById('networkType').textContent = displayType;
            document.getElementById('networkSpeed').textContent = `${speed} Mbps`;
            
            updateSignalBars(latency, speed);
        }

        function simulateRealisticNetwork() {
            if (!isOnline) {
                updateNetworkUIRealTime();
                return;
            }
            
            const now = new Date();
            const hour = now.getHours();
            const minute = now.getMinutes();
            
            let networkType, speed, latency;
            
            if (hour >= 22 || hour < 6) {
                networkType = ['5G', 'Wi-Fi'][Math.floor(Math.random() * 2)];
                speed = networkType === '5G' ? (Math.random() * 500 + 300) : (Math.random() * 300 + 150);
                latency = networkType === '5G' ? Math.floor(Math.random() * 15 + 5) : Math.floor(Math.random() * 25 + 10);
            } else if (hour >= 17 && hour < 22) {
                networkType = ['4G', 'Wi-Fi'][Math.floor(Math.random() * 2)];
                speed = networkType === '4G' ? (Math.random() * 100 + 50) : (Math.random() * 200 + 50);
                latency = networkType === '4G' ? Math.floor(Math.random() * 40 + 20) : Math.floor(Math.random() * 30 + 15);
            } else if (hour >= 12 && hour < 17) {
                networkType = ['4G', '5G'][Math.floor(Math.random() * 2)];
                speed = networkType === '5G' ? (Math.random() * 400 + 200) : (Math.random() * 150 + 50);
                latency = networkType === '5G' ? Math.floor(Math.random() * 20 + 10) : Math.floor(Math.random() * 35 + 15);
            } else {
                networkType = ['4G', 'Wi-Fi', '5G'][Math.floor(Math.random() * 3)];
                speed = networkType === '5G' ? (Math.random() * 450 + 250) : 
                       networkType === 'Wi-Fi' ? (Math.random() * 250 + 100) : 
                       (Math.random() * 120 + 40);
                latency = networkType === '5G' ? Math.floor(Math.random() * 18 + 8) :
                         networkType === 'Wi-Fi' ? Math.floor(Math.random() * 25 + 12) :
                         Math.floor(Math.random() * 30 + 15);
            }
            
            const minuteFactor = Math.sin(minute * 0.1) * 0.1 + 1;
            speed *= minuteFactor;
            
            document.getElementById('networkType').textContent = networkType;
            document.getElementById('networkSpeed').textContent = `${speed.toFixed(1)} Mbps`;
            
            updateSignalBars(latency, speed);
        }

        function updateSignalBars(latency, speed) {
            const signalBars = document.querySelectorAll('.signal-bar');
            let strength = 5;
            
            if (latency > 100 || speed < 10) strength = 1;
            else if (latency > 70 || speed < 25) strength = 2;
            else if (latency > 40 || speed < 50) strength = 3;
            else if (latency > 20 || speed < 100) strength = 4;
            
            signalBars.forEach((bar, index) => {
                if (index < strength) {
                    bar.style.background = '#4cc9f0';
                    bar.style.boxShadow = '0 0 4px #4cc9f0';
                } else {
                    bar.style.background = 'rgba(255, 255, 255, 0.2)';
                    bar.style.boxShadow = 'none';
                }
            });
        }

        function updateNetworkBadge() {
            if (!isOnline) {
                const networkBadge = document.getElementById('networkBadge');
                if (networkBadge) {
                    networkBadge.style.display = 'none';
                }
                return;
            }
            
            const badge = document.getElementById('networkBadge');
            if (!badge) return;
            
            const now = new Date();
            const seconds = now.getSeconds();
            
            const networkSpeed = parseFloat(document.getElementById('networkSpeed').textContent);
            
            if (networkSpeed > 200) {
                badge.style.background = '#4cc9f0';
                badge.innerHTML = '<i class="fas fa-bolt"></i>';
            } else if (networkSpeed > 50) {
                badge.style.background = '#43a047';
                badge.innerHTML = '<i class="fas fa-check"></i>';
            } else {
                badge.style.background = '#ff9800';
                badge.innerHTML = '<i class="fas fa-exclamation"></i>';
            }
            
            if (seconds % 2 === 0) {
                badge.style.animation = 'badgePulse 0.5s ease';
                setTimeout(() => {
                    badge.style.animation = '';
                }, 500);
            }
        }

        function trackNetworkPerformance() {
            if (!isOnline) return;
            
            const networkSpeed = document.getElementById('networkSpeed').textContent;
            const networkType = document.getElementById('networkType').textContent;
            
            networkHistory.push({
                timestamp: new Date().toISOString(),
                speed: parseFloat(networkSpeed),
                type: networkType,
                latency: Math.floor(Math.random() * 50 + 20)
            });
            
            if (networkHistory.length > 100) {
                networkHistory = networkHistory.slice(-100);
            }
        }

        function storeNetworkHistory() {
            if (!db || networkHistory.length === 0 || !isOnline) return;
            
            const transaction = db.transaction(['networkHistory'], 'readwrite');
            const historyStore = transaction.objectStore('networkHistory');
            
            const latestRecord = networkHistory[networkHistory.length - 1];
            historyStore.put(latestRecord);
        }

        function startAutoSync() {
            if (!isOnline) return;
            
            if (syncInterval) {
                clearInterval(syncInterval);
            }
            
            syncInterval = setInterval(() => {
                if (isOnline) {
                    syncWithServer();
                }
            }, 5000);
            
            setTimeout(() => {
                syncWithServer();
            }, 1000);
        }

        function syncWithServer() {
            if (!isOnline || !db) {
                return;
            }
            
            const transaction = db.transaction(['serverSyncQueue', 'offlineStorage'], 'readwrite');
            const syncStore = transaction.objectStore('serverSyncQueue');
            const offlineStore = transaction.objectStore('offlineStorage');
            const syncRequest = syncStore.getAll();
            const offlineRequest = offlineStore.getAll();
            
            syncRequest.onsuccess = function() {
                const queue = syncRequest.result || [];
                if (queue.length === 0) {
                    offlineRequest.onsuccess = function() {
                        const offlineQueue = offlineRequest.result || [];
                        if (offlineQueue.length === 0) {
                        } else {
                            syncLargeFiles(offlineQueue);
                        }
                    };
                    return;
                }
                
                queue.forEach(item => {
                    if (!item.synced) {
                        simulateServerSync(item);
                    }
                });
            };
        }

        function syncLargeFiles(files) {
            if (!isOnline || !db || files.length === 0) return;
            
            files.forEach(file => {
                if (!file.synced) {
                    simulateLargeFileSync(file);
                }
            });
        }

        function simulateLargeFileSync(file) {
            return new Promise((resolve) => {
                setTimeout(() => {
                    if (!db) {
                        resolve(false);
                        return;
                    }
                    
                    const transaction = db.transaction(['offlineStorage'], 'readwrite');
                    const offlineStore = transaction.objectStore('offlineStorage');
                    
                    file.synced = true;
                    file.syncedAt = new Date().toISOString();
                    
                    const updateRequest = offlineStore.put(file);
                    
                    updateRequest.onsuccess = function() {
                        serverSimulation.lastSync = new Date().toISOString();
                        resolve(true);
                    };
                    
                    updateRequest.onerror = function() {
                        resolve(false);
                    };
                }, Math.random() * 2000 + 1000);
            });
        }

        function simulateServerSync(item) {
            return new Promise((resolve) => {
                setTimeout(() => {
                    if (!db) {
                        resolve(false);
                        return;
                    }
                    
                    const transaction = db.transaction(['serverSyncQueue'], 'readwrite');
                    const syncStore = transaction.objectStore('serverSyncQueue');
                    
                    item.synced = true;
                    item.syncedAt = new Date().toISOString();
                    
                    const updateRequest = syncStore.put(item);
                    
                    updateRequest.onsuccess = function() {
                        serverSimulation.lastSync = new Date().toISOString();
                        resolve(true);
                    };
                    
                    updateRequest.onerror = function() {
                        resolve(false);
                    };
                }, Math.random() * 1000 + 500);
            });
        }

        function processMediateData() {
            if (!isOnline) return;
            
            setTimeout(() => {
                const pendingChanges = serverSimulation.queue.filter(item => !item.synced).length;
                if (pendingChanges > 0) {
                    showNotification(`Processing ${pendingChanges} pending changes...`, 'info');
                    syncWithServer();
                }
            }, 2000);
        }

        function startRealTimeProcessing() {
            if (realTimeInterval) {
                clearInterval(realTimeInterval);
            }
            
            realTimeInterval = setInterval(() => {
                if (!currentUserId) return;
                
                processRealTimeUpdates();
                updateRealTimeUI();
            }, 2000);
        }

        function processRealTimeUpdates() {
            if (!isOnline) return;
            
            const now = new Date();
            const updates = [];
            
            teamMembers.forEach(member => {
                if (member.id !== currentUserId && Math.random() > 0.7) {
                    updates.push({
                        type: 'userStatus',
                        userId: member.id,
                        status: Math.random() > 0.3 ? 'online' : 'away',
                        timestamp: now.toISOString()
                    });
                }
            });
            
            tasks.forEach(task => {
                if (Math.random() > 0.8 && task.status !== 'completed') {
                    updates.push({
                        type: 'taskUpdate',
                        taskId: task.id,
                        progress: Math.min(task.status === 'in-progress' ? task.progress || 0 + 10 : 10, 100),
                        timestamp: now.toISOString()
                    });
                }
            });
            
            if (updates.length > 0 && db) {
                const transaction = db.transaction(['realTimeUpdates'], 'readwrite');
                const updateStore = transaction.objectStore('realTimeUpdates');
                
                updates.forEach(update => {
                    updateStore.put(update);
                });
            }
        }

        function updateRealTimeUI() {
            if (!currentUserId) return;
            
            const progressBar = document.getElementById('progressBar');
            if (progressBar) {
                const completedTasks = tasks.filter(t => t.status === 'completed').length;
                const totalTasks = tasks.length;
                if (totalTasks > 0) {
                    const progress = Math.round((completedTasks / totalTasks) * 100);
                    progressBar.style.width = progress + '%';
                    const progressText = document.getElementById('progressText');
                    if (progressText) {
                        progressText.textContent = progress + '% Complete';
                    }
                }
            }
        }

        function generateId() {
            return Date.now().toString(36) + Math.random().toString(36).substr(2);
        }

        function generateEmployeeId() {
            const count = teamMembers.length + 1;
            return `WF-${count.toString().padStart(3, '0')}`;
        }

        function saveAllCredentials() {
            const errorDiv = document.getElementById('setupError');
            errorDiv.style.display = 'none';
            
            const ceoUsername = document.getElementById('ceoUsername').value.trim();
            const ceoPassword = document.getElementById('ceoPassword').value;
            const ceoConfirm = document.getElementById('ceoConfirmPassword').value;
            
            const adminUsername = document.getElementById('adminUsername').value.trim();
            const adminPassword = document.getElementById('adminPassword').value;
            const adminConfirm = document.getElementById('adminConfirmPassword').value;
            
            const managerUsername = document.getElementById('managerUsername').value.trim();
            const managerPassword = document.getElementById('managerPassword').value;
            const managerConfirm = document.getElementById('managerConfirmPassword').value;
            
            const member1Username = document.getElementById('member1Username').value.trim();
            const member1Password = document.getElementById('member1Password').value;
            const member1Confirm = document.getElementById('member1ConfirmPassword').value;
            
            const errors = [];
            
            if (!ceoUsername || !ceoPassword || !ceoConfirm) errors.push('CEO account incomplete');
            if (!adminUsername || !adminPassword || !adminConfirm) errors.push('Admin account incomplete');
            if (!managerUsername || !managerPassword || !managerConfirm) errors.push('Manager account incomplete');
            if (!member1Username || !member1Password || !member1Confirm) errors.push('Member account incomplete');
            
            if (ceoPassword !== ceoConfirm) errors.push('CEO passwords do not match');
            if (adminPassword !== adminConfirm) errors.push('Admin passwords do not match');
            if (managerPassword !== managerConfirm) errors.push('Manager passwords do not match');
            if (member1Password !== member1Confirm) errors.push('Member passwords do not match');
            
            const usernames = [ceoUsername, adminUsername, managerUsername, member1Username];
            const uniqueUsernames = [...new Set(usernames)];
            if (uniqueUsernames.length !== usernames.length) {
                errors.push('All usernames must be unique');
            }
            
            const passwords = [ceoPassword, adminPassword, managerPassword, member1Password];
            passwords.forEach((pass, index) => {
                if (pass.length < 6) {
                    errors.push(`Password for ${usernames[index]} must be at least 6 characters`);
                }
            });
            
            if (errors.length > 0) {
                showError(errors.join('<br>'));
                return;
            }
            
            teamMembers = [
                {
                    id: generateId(),
                    username: ceoUsername,
                    password: ceoPassword,
                    fullName: 'Chief Executive Officer',
                    role: 'ceo',
                    email: 'ceo@willfort.com',
                    phone: '+1 (555) CEO-1234',
                    department: 'Executive',
                    status: 'offline',
                    lastLogin: null,
                    joinDate: new Date().toISOString(),
                    employeeId: 'WF-001',
                    createdBy: 'system'
                },
                {
                    id: generateId(),
                    username: adminUsername,
                    password: adminPassword,
                    fullName: 'Administrator',
                    role: 'admin',
                    email: 'admin@willfort.com',
                    phone: '+1 (555) ADM-1234',
                    department: 'Administration',
                    status: 'offline',
                    lastLogin: null,
                    joinDate: new Date().toISOString(),
                    employeeId: 'WF-002',
                    createdBy: 'system'
                },
                {
                    id: generateId(),
                    username: managerUsername,
                    password: managerPassword,
                    fullName: 'Project Manager',
                    role: 'manager',
                    email: 'manager@willfort.com',
                    phone: '+1 (555) MGR-1234',
                    department: 'Management',
                    status: 'offline',
                    lastLogin: null,
                    joinDate: new Date().toISOString(),
                    employeeId: 'WF-003',
                    createdBy: 'system'
                },
                {
                    id: generateId(),
                    username: member1Username,
                    password: member1Password,
                    fullName: 'Team Member 1',
                    role: 'member',
                    email: 'member1@willfort.com',
                    phone: '+1 (555) MEM-1234',
                    department: 'Operations',
                    status: 'offline',
                    lastLogin: null,
                    joinDate: new Date().toISOString(),
                    employeeId: 'WF-004',
                    createdBy: 'system'
                }
            ];
            
            tasks = [
                {
                    id: generateId(),
                    title: 'Dashboard Initial Setup',
                    assignee: teamMembers[3].id,
                    assigneeUsername: teamMembers[3].username,
                    assigneeName: teamMembers[3].fullName,
                    assignedBy: teamMembers[0].username,
                    assignedById: teamMembers[0].id,
                    assignedByRole: 'ceo',
                    dueDate: new Date(Date.now() + 7 * 24 * 60 * 60 * 1000).toISOString().split('T')[0],
                    priority: 'high',
                    status: 'in-progress',
                    isRecent: false,
                    created: new Date().toISOString(),
                    updated: new Date().toISOString()
                },
                {
                    id: generateId(),
                    title: 'User Documentation',
                    assignee: teamMembers[1].id,
                    assigneeUsername: teamMembers[1].username,
                    assigneeName: teamMembers[1].fullName,
                    assignedBy: teamMembers[0].username,
                    assignedById: teamMembers[0].id,
                    assignedByRole: 'ceo',
                    dueDate: new Date(Date.now() + 3 * 24 * 60 * 60 * 1000).toISOString().split('T')[0],
                    priority: 'medium',
                    status: 'pending',
                    isRecent: false,
                    created: new Date().toISOString(),
                    updated: new Date().toISOString()
                },
                {
                    id: generateId(),
                    title: 'Team Meeting',
                    assignee: teamMembers[2].id,
                    assigneeUsername: teamMembers[2].username,
                    assigneeName: teamMembers[2].fullName,
                    assignedBy: teamMembers[0].username,
                    assignedById: teamMembers[0].id,
                    assignedByRole: 'ceo',
                    dueDate: new Date(Date.now() + 1 * 24 * 60 * 60 * 1000).toISOString().split('T')[0],
                    priority: 'high',
                    status: 'completed',
                    isRecent: true,
                    created: new Date().toISOString(),
                    updated: new Date().toISOString()
                }
            ];
            
            activities = [
                {
                    id: generateId(),
                    user: ceoUsername,
                    userId: teamMembers[0].id,
                    userRole: 'ceo',
                    action: 'System initialized and CEO setup completed',
                    timestamp: new Date().toISOString(),
                    type: 'system',
                    details: 'Initial system setup with 4 users'
                }
            ];
            
            localStorage.setItem('ceoSetupCompleted', 'true');
            saveToIndexedDB();
            
            document.getElementById('ceoSetupModal').style.display = 'none';
            showAdminLogin();
            
            showNotification('Setup completed successfully! You can now login.');
        }

        function showError(message) {
            const errorDiv = document.getElementById('setupError');
            errorDiv.innerHTML = `<i class="fas fa-exclamation-triangle"></i> ${message}`;
            errorDiv.style.display = 'block';
        }

        function showAdminLogin() {
            document.getElementById('loginModal').style.display = 'flex';
            document.getElementById('personalLoginModal').style.display = 'none';
            document.getElementById('ceoSetupModal').style.display = 'none';
            document.getElementById('adminLoginError').style.display = 'none';
            document.getElementById('adminLoginUser').value = '';
            document.getElementById('adminLoginPass').value = '';
        }

        function showPersonalLogin() {
            document.getElementById('personalLoginModal').style.display = 'flex';
            document.getElementById('loginModal').style.display = 'none';
            document.getElementById('personalLoginError').style.display = 'none';
            document.getElementById('personalUsername').value = '';
            document.getElementById('personalPassword').value = '';
        }

        function adminLogin() {
            const username = document.getElementById('adminLoginUser').value.trim();
            const password = document.getElementById('adminLoginPass').value;
            const errorDiv = document.getElementById('adminLoginError');
            const errorText = document.getElementById('adminLoginErrorText');
            
            if (!username || !password) {
                errorText.textContent = 'Please fill in all required fields';
                errorDiv.style.display = 'flex';
                return;
            }
            
            const user = teamMembers.find(member => 
                member.username === username && member.password === password
            );
            
            if (user && (user.role === 'ceo' || user.role === 'admin' || user.role === 'manager')) {
                currentUser = user.username;
                currentRole = user.role;
                currentUserId = user.id;
                isPersonalMode = false;
                
                user.status = 'online';
                user.lastLogin = new Date().toISOString();
                saveToIndexedDB();
                
                addActivity(user.username, user.id, user.role, 'logged into admin dashboard');
                
                document.getElementById('loginModal').style.display = 'none';
                document.getElementById('mainDashboard').style.display = 'flex';
                
                updateDashboardUI();
                loadDashboardData();
                applyPermissions();
                showRoleSpecificMenuButtons();
                
                localStorage.setItem('currentSession', JSON.stringify({
                    username: user.username,
                    role: user.role,
                    id: user.id,
                    isPersonalMode: false,
                    loginTime: new Date().toISOString()
                }));
                
                loadUserProfileImage(currentUserId).then(() => {
                    updateProfileImageDisplay(currentUserId);
                });
                
                showNotification(`Welcome back, ${user.username}!`);
                
                if (isOnline) {
                    startAutoSync();
                }
            } else {
                errorText.textContent = 'Invalid credentials or insufficient permissions';
                errorDiv.style.display = 'flex';
            }
        }

        function personalLogin() {
            const username = document.getElementById('personalUsername').value.trim();
            const password = document.getElementById('personalPassword').value;
            const errorDiv = document.getElementById('personalLoginError');
            const errorText = document.getElementById('personalLoginErrorText');
            
            if (!username || !password) {
                errorText.textContent = 'Please fill in all required fields';
                errorDiv.style.display = 'flex';
                return;
            }
            
            const user = teamMembers.find(member => 
                member.username === username && member.password === password
            );
            
            if (user) {
                currentUser = user.username;
                currentRole = user.role;
                currentUserId = user.id;
                isPersonalMode = true;
                
                user.status = 'online';
                user.lastLogin = new Date().toISOString();
                saveToIndexedDB();
                
                addActivity(user.username, user.id, user.role, 'logged into personal dashboard');
                
                document.getElementById('personalLoginModal').style.display = 'none';
                document.getElementById('personalDashboard').style.display = 'flex';
                
                updatePersonalDashboard();
                
                localStorage.setItem('currentSession', JSON.stringify({
                    username: user.username,
                    role: user.role,
                    id: user.id,
                    isPersonalMode: true,
                    loginTime: new Date().toISOString()
                }));
                
                loadUserProfileImage(currentUserId).then(() => {
                    updateProfileImageDisplay(currentUserId);
                });
                
                showNotification(`Welcome, ${user.username}!`);
                
                if (isOnline) {
                    startAutoSync();
                }
            } else {
                errorText.textContent = 'Invalid username or password';
                errorDiv.style.display = 'flex';
            }
        }

        function checkStoredSession() {
            const storedSession = localStorage.getItem('currentSession');
            if (storedSession) {
                const session = JSON.parse(storedSession);
                const user = teamMembers.find(m => m.id === session.id);
                
                if (user && user.password) {
                    currentUser = user.username;
                    currentRole = user.role;
                    currentUserId = user.id;
                    isPersonalMode = session.isPersonalMode;
                    
                    loadUserProfileImage(currentUserId).then(() => {
                        updateProfileImageDisplay(currentUserId);
                    });
                    
                    if (isPersonalMode) {
                        document.getElementById('personalDashboard').style.display = 'flex';
                        updatePersonalDashboard();
                    } else {
                        document.getElementById('mainDashboard').style.display = 'flex';
                        updateDashboardUI();
                        loadDashboardData();
                        applyPermissions();
                        showRoleSpecificMenuButtons();
                    }
                    
                    document.getElementById('loginModal').style.display = 'none';
                    document.getElementById('personalLoginModal').style.display = 'none';
                    
                    user.status = 'online';
                    saveToIndexedDB();
                    
                    if (isOnline) {
                        startAutoSync();
                    }
                } else {
                    localStorage.removeItem('currentSession');
                }
            }
        }

        function updateDashboardUI() {
            document.getElementById('currentUserName').textContent = currentUser;
            
            const roleBadge = document.getElementById('currentUserRoleBadge');
            roleBadge.textContent = currentRole.toUpperCase();
            roleBadge.className = `role-badge role-${currentRole}`;
            
            const headerTitle = document.getElementById('headerTitle');
            let roleText = '';
            let icon = 'fas fa-chart-pie';
            
            switch(currentRole) {
                case 'ceo': 
                    roleText = 'CEO Dashboard'; 
                    icon = 'fas fa-crown';
                    break;
                case 'admin': 
                    roleText = 'Administrator Dashboard'; 
                    icon = 'fas fa-user-shield';
                    break;
                case 'manager': 
                    roleText = 'Manager Dashboard'; 
                    icon = 'fas fa-user-tie';
                    break;
                default: 
                    roleText = 'Dashboard';
            }
            
            headerTitle.innerHTML = `<i class="${icon}"></i> WillFort GSquad - ${roleText} <span class="online-badge online" id="headerOnlineStatus">Live</span>`;
            
            updateTabs();
        }

        function showRoleSpecificMenuButtons() {
            const adminMenu = document.getElementById('adminMenu');
            const ceoManagerMenu = document.getElementById('ceoManagerMenu');
            
            adminMenu.style.display = 'none';
            ceoManagerMenu.style.display = 'none';
            
            if (currentRole === 'admin') {
                adminMenu.style.display = 'flex';
            }
            
            if (currentRole === 'ceo' || currentRole === 'manager') {
                ceoManagerMenu.style.display = 'flex';
            }
        }

        function updatePersonalDashboard() {
            const user = teamMembers.find(m => m.id === currentUserId);
            if (!user) return;
            
            document.getElementById('personalUserName').textContent = user.username;
            document.getElementById('personalUsernameDisplay').textContent = user.username;
            document.getElementById('personalIdDisplay').textContent = user.employeeId || user.id.substring(0, 8);
            document.getElementById('personalLastLogin').textContent = 
                user.lastLogin ? new Date(user.lastLogin).toLocaleString() : 'Never';
            
            const roleBadge = document.getElementById('personalUserRoleBadge');
            roleBadge.textContent = user.role.toUpperCase();
            roleBadge.className = `role-badge role-${user.role}`;
            
            const personalHeaderTitle = document.getElementById('personalHeaderTitle');
            let roleText = '';
            let icon = 'fas fa-user-circle';
            
            switch(user.role) {
                case 'ceo': 
                    roleText = 'CEO Personal Dashboard'; 
                    icon = 'fas fa-crown';
                    break;
                case 'admin': 
                    roleText = 'Admin Personal Dashboard'; 
                    icon = 'fas fa-user-shield';
                    break;
                case 'manager': 
                    roleText = 'Manager Personal Dashboard'; 
                    icon = 'fas fa-user-tie';
                    break;
                default: 
                    roleText = 'My Personal Dashboard';
            }
            
            personalHeaderTitle.innerHTML = `<i class="${icon}"></i> ${roleText} <span class="online-badge online">Personal</span>`;
            
            loadPersonalInfo(user);
            loadPersonalTasks();
            loadPersonalActivities();
            updatePersonalTabs();
        }

        function updateTabs() {
            const navItems = document.querySelectorAll('#mainDashboard .nav-item');
            navItems.forEach(item => {
                item.removeEventListener('click', handleTabClick);
                item.addEventListener('click', handleTabClick);
            });
        }

        function handleTabClick(e) {
            const navItems = document.querySelectorAll('#mainDashboard .nav-item');
            navItems.forEach(i => i.classList.remove('active'));
            this.classList.add('active');
            
            const tab = this.getAttribute('data-tab');
            
            document.querySelectorAll('#mainDashboard .dashboard-grid').forEach(content => {
                content.style.display = 'none';
            });
            
            const tabContent = document.getElementById(tab + 'Tab');
            if (tabContent) {
                tabContent.style.display = 'grid';
            }
            
            switch(tab) {
                case 'overview':
                    loadOverviewData();
                    break;
                case 'tasks':
                    loadTasksData();
                    break;
                case 'team':
                    loadTeamData();
                    break;
                case 'activity':
                    loadActivityData();
                    break;
            }
        }

        function updatePersonalTabs() {
            const navItems = document.querySelectorAll('#personalDashboard .nav-item');
            navItems.forEach(item => {
                item.removeEventListener('click', handlePersonalTabClick);
                item.addEventListener('click', handlePersonalTabClick);
            });
        }

        function handlePersonalTabClick(e) {
            const navItems = document.querySelectorAll('#personalDashboard .nav-item');
            navItems.forEach(i => i.classList.remove('active'));
            this.classList.add('active');
            
            const tab = this.getAttribute('data-tab');
            
            document.querySelectorAll('#personalDashboard .dashboard-grid').forEach(content => {
                content.style.display = 'none';
            });
            
            const tabContent = document.getElementById(tab + 'Tab');
            if (tabContent) {
                tabContent.style.display = 'grid';
            }
            
            const user = teamMembers.find(m => m.id === currentUserId);
            switch(tab) {
                case 'mypersonal':
                    loadPersonalInfo(user);
                    break;
                case 'mytasks':
                    loadPersonalTasks();
                    break;
                case 'myactivity':
                    loadPersonalActivities();
                    break;
            }
        }

        function loadDashboardData() {
            loadOverviewData();
            loadTasksData();
            loadTeamData();
            loadActivityData();
        }

        function loadOverviewData() {
            const totalTasks = tasks.length;
            const completedTasks = tasks.filter(t => t.status === 'completed').length;
            const progress = totalTasks > 0 ? Math.round((completedTasks / totalTasks) * 100) : 0;
            
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('progressText').textContent = progress + '% Complete';
            document.getElementById('completedCount').textContent = completedTasks;
            document.getElementById('remainingCount').textContent = totalTasks - completedTasks;
            document.getElementById('teamCount').textContent = teamMembers.length;
            
            const onlineCount = teamMembers.filter(m => m.status === 'online').length;
            document.getElementById('onlineCount').textContent = onlineCount + ' online';
            
            loadRecentTasks();
            loadTeamStatus();
        }

        function loadRecentTasks() {
            const table = document.getElementById('recentTasksTable');
            const recentTasks = tasks.filter(t => t.isRecent || t.status === 'completed').slice(-3).reverse();
            
            if (recentTasks.length === 0) {
                table.innerHTML = '<tr><td colspan="4" class="empty-state">No tasks yet</td></tr>';
                return;
            }
            
            let html = '';
            recentTasks.forEach(task => {
                const assigneeMember = teamMembers.find(m => m.id === task.assignee);
                const assigneeName = assigneeMember ? assigneeMember.username : 'Unknown';
                
                const dueDate = new Date(task.dueDate);
                const now = new Date();
                const daysLeft = Math.ceil((dueDate - now) / (1000 * 60 * 60 * 24));
                let dueText = daysLeft + ' days';
                if (daysLeft < 0) dueText = 'Overdue';
                if (daysLeft === 0) dueText = 'Today';
                if (daysLeft === 1) dueText = 'Tomorrow';
                
                const assignedByMember = teamMembers.find(m => m.id === task.assignedById);
                const assignedByName = assignedByMember ? assignedByMember.username : task.assignedBy;
                const assignedByRole = task.assignedByRole || (assignedByMember ? assignedByMember.role : 'unknown');
                
                html += `
                <tr>
                    <td style="width: 30px;">
                        <div class="compact-checkbox ${task.status === 'completed' ? 'checked' : ''}">
                            ${task.status === 'completed' ? '<i class="fas fa-check"></i>' : ''}
                        </div>
                    </td>
                    <td class="text-truncate" title="${task.title}">
                        ${task.title}
                        <span class="assigned-by ${assignedByRole}">Assigned by: ${assignedByName} (${assignedByRole})</span>
                    </td>
                    <td>${assigneeName}</td>
                    <td class="text-right">
                        <span class="priority-badge priority-${task.priority}">${task.priority}</span>
                    </td>
                </tr>
                `;
            });
            
            table.innerHTML = html;
        }

        function loadTeamStatus() {
            const table = document.getElementById('teamStatusTable');
            
            if (teamMembers.length === 0) {
                table.innerHTML = '<tr><td colspan="3" class="empty-state">No team members yet</td></tr>';
                return;
            }
            
            let html = '';
            teamMembers.forEach(member => {
                let roleIcon = 'fas fa-user';
                if (member.role === 'ceo') roleIcon = 'fas fa-crown';
                if (member.role === 'admin') roleIcon = 'fas fa-user-shield';
                if (member.role === 'manager') roleIcon = 'fas fa-user-tie';
                
                html += `
                <tr>
                    <td style="width: 30px;">
                        <div class="status-indicator status-${member.status}"></div>
                    </td>
                    <td class="text-truncate" title="${member.fullName}">
                        <i class="${roleIcon}"></i> ${member.username}
                        <span class="role-badge role-${member.role}">${member.role.toUpperCase()}</span>
                    </td>
                    <td class="text-right">
                        <span class="online-badge ${member.status}">${member.status}</span>
                    </td>
                </tr>
                `;
            });
            
            table.innerHTML = html;
        }

        function loadTasksData() {
            const totalTasks = tasks.length;
            document.getElementById('totalTasks').textContent = totalTasks + ' tasks';
            
            const table = document.getElementById('allTasksTable');
            
            if (tasks.length === 0) {
                table.innerHTML = '<tr><td colspan="5" class="empty-state">No tasks yet</td></tr>';
                return;
            }
            
            let html = '';
            tasks.forEach(task => {
                const assigneeMember = teamMembers.find(m => m.id === task.assignee);
                const assigneeName = assigneeMember ? assigneeMember.username : 'Unknown';
                
                const dueDate = new Date(task.dueDate);
                const formattedDate = dueDate.toLocaleDateString('en-US', { 
                    month: 'short', 
                    day: 'numeric' 
                });
                
                const assignedByMember = teamMembers.find(m => m.id === task.assignedById);
                const assignedByName = assignedByMember ? assignedByMember.username : task.assignedBy;
                const assignedByRole = task.assignedByRole || (assignedByMember ? assignedByMember.role : 'unknown');
                
                const canEditDelete = hasPermission('canEditTask');
                const canMarkComplete = hasPermission('canMarkTaskComplete');
                const canMarkRecent = hasPermission('canMarkTaskRecent');
                
                html += `
                <tr>
                    <td style="width: 30px;">
                        <div class="compact-checkbox ${task.status === 'completed' ? 'checked' : ''}">
                            ${task.status === 'completed' ? '<i class="fas fa-check"></i>' : ''}
                        </div>
                    </td>
                    <td class="text-truncate" title="${task.title}">
                        ${task.title}
                        ${task.isRecent ? '<span class="badge bg-info" style="margin-left: 5px;">Recent</span>' : ''}
                        <span class="assigned-by ${assignedByRole}">Assigned by: ${assignedByName} (${assignedByRole})</span>
                    </td>
                    <td>${assigneeName}</td>
                    <td>
                        <span class="priority-badge priority-${task.priority}">${task.priority}</span>
                    </td>
                    <td class="text-right">
                        ${canEditDelete ? `
                        <span class="action-btn" onclick="editTask('${task.id}')" title="Edit">
                            <i class="fas fa-edit"></i>
                        </span>
                        <span class="action-btn" onclick="deleteTask('${task.id}')" title="Delete">
                            <i class="fas fa-trash"></i>
                        </span>
                        ` : ''}
                        
                        ${canMarkComplete ? `
                        <button class="status-btn btn-complete" onclick="markTaskComplete('${task.id}')" 
                                title="Mark Complete" ${task.status === 'completed' ? 'disabled' : ''}>
                            <i class="fas fa-check-circle"></i>
                        </button>
                        ` : ''}
                        
                        ${canMarkRecent ? `
                        <button class="status-btn btn-mark-recent" onclick="toggleTaskRecent('${task.id}')" 
                                title="${task.isRecent ? 'Remove Recent' : 'Mark as Recent'}">
                            <i class="fas ${task.isRecent ? 'fa-star' : 'fa-star-o'}"></i>
                        </button>
                        ` : ''}
                    </td>
                </tr>
                `;
            });
            
            table.innerHTML = html;
        }

        function markTaskComplete(taskId) {
            if (!hasPermission('canMarkTaskComplete')) {
                showNotification('Only managers can mark tasks as complete', 'error');
                return;
            }
            
            const taskIndex = tasks.findIndex(t => t.id === taskId);
            if (taskIndex === -1) return;
            
            tasks[taskIndex].status = 'completed';
            tasks[taskIndex].updated = new Date().toISOString();
            saveToIndexedDB();
            
            addActivity(currentUser, currentUserId, currentRole, `marked task "${tasks[taskIndex].title}" as completed`);
            
            loadOverviewData();
            loadTasksData();
            if (isPersonalMode) loadPersonalTasks();
            
            showNotification('Task marked as completed!');
        }

        function toggleTaskRecent(taskId) {
            if (!hasPermission('canMarkTaskRecent')) {
                showNotification('Only managers can mark tasks as recent', 'error');
                return;
            }
            
            const taskIndex = tasks.findIndex(t => t.id === taskId);
            if (taskIndex === -1) return;
            
            tasks[taskIndex].isRecent = !tasks[taskIndex].isRecent;
            tasks[taskIndex].updated = new Date().toISOString();
            saveToIndexedDB();
            
            const action = tasks[taskIndex].isRecent ? 'marked as recent' : 'removed from recent';
            addActivity(currentUser, currentUserId, currentRole, `${action} task "${tasks[taskIndex].title}"`);
            
            loadOverviewData();
            loadTasksData();
            
            showNotification(`Task ${action}!`);
        }

        function loadTeamData() {
            const membersCount = teamMembers.length;
            document.getElementById('membersCount').textContent = membersCount + ' members';
            
            const table = document.getElementById('teamMembersTable');
            
            if (teamMembers.length === 0) {
                table.innerHTML = '<tr><td colspan="6" class="empty-state">No members yet</td></tr>';
                return;
            }
            
            let html = '';
            teamMembers.forEach(member => {
                const canEdit = hasPermission('canEditPerson') && member.id !== currentUserId;
                const canDelete = hasPermission('canDeletePerson') && member.id !== currentUserId;
                const canPromote = hasPermission('canPromotePerson') && member.id !== currentUserId && member.role !== 'ceo';
                
                html += `
                <tr>
                    <td style="width: 30px;">
                        <div class="status-indicator status-${member.status}"></div>
                    </td>
                    <td class="text-truncate" title="${member.fullName}">${member.fullName}</td>
                    <td>${member.username}</td>
                    <td><span class="role-badge role-${member.role}">${member.role.toUpperCase()}</span></td>
                    <td>${member.department}</td>
                    <td class="text-right">
                        <span class="action-btn" onclick="viewMember('${member.id}')" title="View">
                            <i class="fas fa-eye"></i>
                        </span>
                        ${canEdit ? `
                        <span class="action-btn" onclick="editMemberModal('${member.id}')" title="Edit">
                            <i class="fas fa-edit"></i>
                        </span>
                        ` : ''}
                        ${canPromote ? `
                        <span class="action-btn" onclick="promoteMember('${member.id}')" title="Promote">
                            <i class="fas fa-arrow-up"></i>
                        </span>
                        ` : ''}
                        ${canDelete ? `
                        <span class="action-btn" onclick="deleteMember('${member.id}')" title="Delete">
                            <i class="fas fa-trash"></i>
                        </span>
                        ` : ''}
                    </td>
                </tr>
                `;
            });
            
            table.innerHTML = html;
        }

        function loadActivityData() {
            const activityCount = activities.length;
            document.getElementById('activityCount').textContent = activityCount + ' activities';
            
            const table = document.getElementById('activityTable');
            
            if (activities.length === 0) {
                table.innerHTML = '<tr><td colspan="3" class="empty-state">No activity yet</td></tr>';
                return;
            }
            
            let html = '';
            const recentActivities = activities.slice(-10).reverse();
            recentActivities.forEach(activity => {
                const time = new Date(activity.timestamp);
                const formattedTime = time.toLocaleString();
                
                const userMember = teamMembers.find(m => m.id === activity.userId);
                const userName = userMember ? userMember.username : activity.user;
                const userRole = activity.userRole || (userMember ? userMember.role : 'unknown');
                
                html += `
                <tr>
                    <td class="text-truncate" title="${userName} (${userRole})">
                        ${userName}
                        <span class="role-badge role-${userRole}">${userRole.toUpperCase()}</span>
                    </td>
                    <td>${activity.action}</td>
                    <td class="text-right">
                        ${formattedTime}
                        ${hasPermission('canClearActivities') ? `
                        <button class="clear-single-btn" onclick="deleteActivity('${activity.id}')" title="Delete">
                            <i class="fas fa-times"></i>
                        </button>
                        ` : ''}
                    </td>
                </tr>
                `;
            });
            
            table.innerHTML = html;
        }

        function loadPersonalInfo(user) {
            const grid = document.getElementById('personalInfoGrid');
            
            const infoItems = [
                { label: 'Full Name', value: user.fullName, icon: 'fas fa-user' },
                { label: 'Email Address', value: user.email, icon: 'fas fa-envelope' },
                { label: 'Phone Number', value: user.phone, icon: 'fas fa-phone' },
                { label: 'Department', value: user.department, icon: 'fas fa-building' },
                { label: 'Role', value: user.role.charAt(0).toUpperCase() + user.role.slice(1), icon: 'fas fa-briefcase' },
                { label: 'Employee ID', value: user.employeeId || 'Not assigned', icon: 'fas fa-id-card' },
                { label: 'Join Date', value: new Date(user.joinDate).toLocaleDateString(), icon: 'fas fa-calendar-alt' },
                { label: 'Status', value: user.status.charAt(0).toUpperCase() + user.status.slice(1), icon: 'fas fa-signal' }
            ];
            
            let html = '';
            infoItems.forEach(item => {
                html += `
                <div class="info-item">
                    <div class="info-label">${item.label}</div>
                    <div class="info-value"><i class="${item.icon}"></i> ${item.value}</div>
                </div>
                `;
            });
            
            grid.innerHTML = html;
        }

        function loadPersonalTasks() {
            const userTasks = tasks.filter(task => task.assignee === currentUserId);
            const taskCount = userTasks.length;
            document.getElementById('personalTaskCount').textContent = taskCount + ' tasks';
            
            const table = document.getElementById('personalTasksTable');
            
            if (userTasks.length === 0) {
                table.innerHTML = '<tr><td colspan="4" class="empty-state">No tasks assigned</td></tr>';
                return;
            }
            
            let html = '';
            userTasks.forEach(task => {
                const dueDate = new Date(task.dueDate);
                const now = new Date();
                const daysLeft = Math.ceil((dueDate - now) / (1000 * 60 * 60 * 24));
                let dueText = daysLeft + ' days left';
                if (daysLeft < 0) dueText = 'Overdue';
                if (daysLeft === 0) dueText = 'Due today';
                if (daysLeft === 1) dueText = 'Due tomorrow';
                
                const assignedByMember = teamMembers.find(m => m.id === task.assignedById);
                const assignedByName = assignedByMember ? assignedByMember.fullName : task.assignedBy;
                const assignedByRole = task.assignedByRole || (assignedByMember ? assignedByMember.role : 'unknown');
                
                let assignmentText = '';
                if (assignedByRole === 'manager' && currentRole !== 'ceo') {
                    assignmentText = `Assigned by Manager: ${assignedByName}`;
                } else if (assignedByRole === 'ceo' && (currentRole === 'manager' || currentRole === 'ceo')) {
                    assignmentText = `Assigned by CEO: ${assignedByName}`;
                } else {
                    assignmentText = `Assigned by: ${assignedByName} (${assignedByRole})`;
                }
                
                html += `
                <tr>
                    <td style="width: 30px;">
                        <div class="compact-checkbox ${task.status === 'completed' ? 'checked' : ''}">
                            ${task.status === 'completed' ? '<i class="fas fa-check"></i>' : ''}
                        </div>
                    </td>
                    <td class="text-truncate" title="${task.title}">
                        ${task.title}
                        <br>
                        <span class="assigned-by ${assignedByRole}">${assignmentText}</span>
                    </td>
                    <td>
                        <span class="priority-badge priority-${task.priority}">${task.priority}</span>
                        ${task.isRecent ? '<span class="badge bg-info" style="margin-left: 5px;">Recent</span>' : ''}
                    </td>
                    <td class="text-right">
                        ${dueText}
                        <br>
                        <small>${dueDate.toLocaleDateString()}</small>
                    </td>
                </tr>
                `;
            });
            
            table.innerHTML = html;
        }

        function loadPersonalActivities() {
            const userActivities = activities.filter(activity => activity.userId === currentUserId);
            const table = document.getElementById('personalActivityTable');
            
            if (userActivities.length === 0) {
                table.innerHTML = '<tr><td colspan="2" class="empty-state">No activity yet</td></tr>';
                return;
            }
            
            let html = '';
            const recentActivities = userActivities.slice(-10).reverse();
            recentActivities.forEach(activity => {
                const time = new Date(activity.timestamp);
                const formattedTime = time.toLocaleString();
                
                html += `
                <tr>
                    <td>${activity.action}</td>
                    <td class="text-right">${formattedTime}</td>
                </tr>
                `;
            });
            
            table.innerHTML = html;
        }

        function clearPersonalActivities() {
            if (!confirm('Are you sure you want to clear your personal activity log? This action cannot be undone.')) {
                return;
            }
            
            activities = activities.filter(activity => activity.userId !== currentUserId);
            saveToIndexedDB();
            loadPersonalActivities();
            
            addActivity(currentUser, currentUserId, currentRole, 'cleared personal activity log');
            showNotification('Your personal activity log has been cleared!');
        }

        function searchRecentTasks(query) {
            const table = document.getElementById('recentTasksTable');
            const rows = table.getElementsByTagName('tr');
            
            for (let i = 0; i < rows.length; i++) {
                const cells = rows[i].getElementsByTagName('td');
                let found = false;
                
                for (let j = 0; j < cells.length; j++) {
                    const cellText = cells[j].textContent.toLowerCase();
                    if (cellText.includes(query.toLowerCase())) {
                        found = true;
                        break;
                    }
                }
                
                rows[i].style.display = found ? '' : 'none';
            }
        }

        function searchTeamStatus(query) {
            const table = document.getElementById('teamStatusTable');
            const rows = table.getElementsByTagName('tr');
            
            for (let i = 0; i < rows.length; i++) {
                const cells = rows[i].getElementsByTagName('td');
                let found = false;
                
                for (let j = 0; j < cells.length; j++) {
                    const cellText = cells[j].textContent.toLowerCase();
                    if (cellText.includes(query.toLowerCase())) {
                        found = true;
                        break;
                    }
                }
                
                rows[i].style.display = found ? '' : 'none';
            }
        }

        function searchAllTasks(query) {
            const table = document.getElementById('allTasksTable');
            const rows = table.getElementsByTagName('tr');
            
            for (let i = 0; i < rows.length; i++) {
                const cells = rows[i].getElementsByTagName('td');
                let found = false;
                
                for (let j = 0; j < cells.length; j++) {
                    const cellText = cells[j].textContent.toLowerCase();
                    if (cellText.includes(query.toLowerCase())) {
                        found = true;
                        break;
                    }
                }
                
                rows[i].style.display = found ? '' : 'none';
            }
        }

        function searchMembers(query) {
            const table = document.getElementById('teamMembersTable');
            const rows = table.getElementsByTagName('tr');
            
            for (let i = 0; i < rows.length; i++) {
                const cells = rows[i].getElementsByTagName('td');
                let found = false;
                
                for (let j = 0; j < cells.length; j++) {
                    const cellText = cells[j].textContent.toLowerCase();
                    if (cellText.includes(query.toLowerCase())) {
                        found = true;
                        break;
                    }
                }
                
                rows[i].style.display = found ? '' : 'none';
            }
        }

        function searchActivity(query) {
            const table = document.getElementById('activityTable');
            const rows = table.getElementsByTagName('tr');
            
            for (let i = 0; i < rows.length; i++) {
                const cells = rows[i].getElementsByTagName('td');
                let found = false;
                
                for (let j = 0; j < cells.length; j++) {
                    const cellText = cells[j].textContent.toLowerCase();
                    if (cellText.includes(query.toLowerCase())) {
                        found = true;
                        break;
                    }
                }
                
                rows[i].style.display = found ? '' : 'none';
            }
        }

        function showTaskModal() {
            if (!hasPermission('canAddTask')) {
                showNotification('Only CEO and Managers can add tasks', 'error');
                return;
            }
            
            document.getElementById('taskForm').reset();
            document.getElementById('taskModalTitle').textContent = 'New Task';
            
            const assigneeSelect = document.getElementById('taskAssignee');
            assigneeSelect.innerHTML = '<option value="">Select member</option>';
            
            teamMembers.forEach(member => {
                const option = document.createElement('option');
                option.value = member.id;
                option.textContent = `${member.username} (${member.fullName})`;
                assigneeSelect.appendChild(option);
            });
            
            const defaultDate = new Date();
            defaultDate.setDate(defaultDate.getDate() + 3);
            document.getElementById('taskDueDate').value = defaultDate.toISOString().split('T')[0];
            
            document.getElementById('taskModal').style.display = 'flex';
        }

        document.getElementById('taskForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            if (!hasPermission('canAddTask')) {
                showNotification('You do not have permission to add tasks', 'error');
                return;
            }
            
            const title = document.getElementById('taskTitle').value.trim();
            const assigneeId = document.getElementById('taskAssignee').value;
            const dueDate = document.getElementById('taskDueDate').value;
            const priority = document.getElementById('taskPriority').value;
            
            if (!title || !assigneeId || !dueDate) {
                showNotification('Please fill all required fields', 'error');
                return;
            }
            
            const assigneeMember = teamMembers.find(m => m.id === assigneeId);
            if (!assigneeMember) {
                showNotification('Selected member not found', 'error');
                return;
            }
            
            const newTask = {
                id: generateId(),
                title: title,
                assignee: assigneeId,
                assigneeUsername: assigneeMember.username,
                assigneeName: assigneeMember.fullName,
                assignedBy: currentUser,
                assignedById: currentUserId,
                assignedByRole: currentRole,
                dueDate: dueDate,
                priority: priority,
                status: 'pending',
                isRecent: false,
                created: new Date().toISOString(),
                updated: new Date().toISOString()
            };
            
            tasks.push(newTask);
            saveToIndexedDB();
            
            addActivity(currentUser, currentUserId, currentRole, `assigned a task to ${assigneeMember.username}`);
            addActivity(assigneeMember.username, assigneeMember.id, assigneeMember.role, `was assigned a task by ${currentUser} (${currentRole})`);
            
            document.getElementById('taskModal').style.display = 'none';
            
            loadOverviewData();
            loadTasksData();
            
            if (assigneeMember.id === currentUserId) {
                loadPersonalTasks();
            }
            
            showNotification('Task created successfully!');
        });

        function showAddPersonModal() {
            if (!hasPermission('canAddPerson')) {
                showNotification('Only CEO, Admin, and Managers can add persons', 'error');
                return;
            }
            
            document.getElementById('addPersonForm').reset();
            document.getElementById('addPersonError').style.display = 'none';
            
            const employeeId = generateEmployeeId();
            document.getElementById('addPersonEmployeeId').value = employeeId;
            
            document.getElementById('addPersonModal').style.display = 'flex';
        }

        document.getElementById('addPersonForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            if (!hasPermission('canAddPerson')) {
                showNotification('You do not have permission to add persons', 'error');
                return;
            }
            
            const errorDiv = document.getElementById('addPersonError');
            errorDiv.style.display = 'none';
            
            const fullName = document.getElementById('addPersonFullName').value.trim();
            const username = document.getElementById('addPersonUsername').value.trim();
            const password = document.getElementById('addPersonPassword').value;
            const confirmPassword = document.getElementById('addPersonConfirmPassword').value;
            const role = document.getElementById('addPersonRole').value;
            const email = document.getElementById('addPersonEmail').value.trim();
            const phone = document.getElementById('addPersonPhone').value.trim();
            const department = document.getElementById('addPersonDepartment').value.trim();
            const employeeId = document.getElementById('addPersonEmployeeId').value;
            
            if (password !== confirmPassword) {
                errorDiv.textContent = 'Passwords do not match';
                errorDiv.style.display = 'block';
                return;
            }
            
            if (password.length < 6) {
                errorDiv.textContent = 'Password must be at least 6 characters';
                errorDiv.style.display = 'block';
                return;
            }
            
            if (teamMembers.some(m => m.username.toLowerCase() === username.toLowerCase())) {
                errorDiv.textContent = 'Username already exists';
                errorDiv.style.display = 'block';
                return;
            }
            
            if (currentRole !== 'ceo' && (role === 'ceo' || role === 'admin')) {
                errorDiv.textContent = 'Only CEO can create CEO or Admin accounts';
                errorDiv.style.display = 'block';
                return;
            }
            
            if (currentRole === 'manager' && role === 'admin') {
                errorDiv.textContent = 'Managers cannot create Admin accounts';
                errorDiv.style.display = 'block';
                return;
            }
            
            const newMember = {
                id: generateId(),
                username: username,
                password: password,
                fullName: fullName,
                role: role,
                email: email,
                phone: phone,
                department: department,
                status: 'offline',
                lastLogin: null,
                joinDate: new Date().toISOString(),
                employeeId: employeeId,
                createdBy: currentUserId
            };
            
            teamMembers.push(newMember);
            saveToIndexedDB();
            
            addActivity(currentUser, currentUserId, currentRole, `added new ${role}: ${fullName} (${username}) with ID ${employeeId}`);
            
            document.getElementById('addPersonModal').style.display = 'none';
            
            loadOverviewData();
            loadTeamData();
            
            showNotification(`Person added successfully with ID: ${employeeId}!`);
        });

        function editTask(taskId) {
            if (!hasPermission('canEditTask')) {
                showNotification('Only CEO and Managers can edit tasks', 'error');
                return;
            }
            
            const task = tasks.find(t => t.id === taskId);
            if (!task) return;
            
            document.getElementById('editTaskId').value = task.id;
            document.getElementById('editTaskTitle').value = task.title;
            document.getElementById('editTaskStatus').value = task.status;
            document.getElementById('editTaskPriority').value = task.priority;
            
            document.getElementById('editTaskModal').style.display = 'flex';
        }

        document.getElementById('editTaskForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            if (!hasPermission('canEditTask')) {
                showNotification('You do not have permission to edit tasks', 'error');
                return;
            }
            
            const taskId = document.getElementById('editTaskId').value;
            const title = document.getElementById('editTaskTitle').value.trim();
            const status = document.getElementById('editTaskStatus').value;
            const priority = document.getElementById('editTaskPriority').value;
            
            const taskIndex = tasks.findIndex(t => t.id === taskId);
            if (taskIndex === -1) return;
            
            const oldStatus = tasks[taskIndex].status;
            tasks[taskIndex].title = title;
            tasks[taskIndex].status = status;
            tasks[taskIndex].priority = priority;
            tasks[taskIndex].updated = new Date().toISOString();
            
            saveToIndexedDB();
            
            if (oldStatus !== status) {
                addActivity(currentUser, currentUserId, currentRole, `changed task "${title}" status from ${oldStatus} to ${status}`);
            } else {
                addActivity(currentUser, currentUserId, currentRole, `updated task: "${title}"`);
            }
            
            document.getElementById('editTaskModal').style.display = 'none';
            
            loadOverviewData();
            loadTasksData();
            if (isPersonalMode) loadPersonalTasks();
            
            showNotification('Task updated successfully!');
        });

        function deleteTask(taskId) {
            if (!hasPermission('canDeleteTask')) {
                showNotification('Only CEO and Managers can delete tasks', 'error');
                return;
            }
            
            if (!confirm('Are you sure you want to delete this task?')) return;
            
            const taskIndex = tasks.findIndex(t => t.id === taskId);
            if (taskIndex === -1) return;
            
            const taskTitle = tasks[taskIndex].title;
            tasks.splice(taskIndex, 1);
            saveToIndexedDB();
            
            addActivity(currentUser, currentUserId, currentRole, `deleted task: "${taskTitle}"`);
            
            loadOverviewData();
            loadTasksData();
            if (isPersonalMode) loadPersonalTasks();
            
            showNotification('Task deleted successfully!');
        }

        function clearCompletedTasks() {
            if (!hasPermission('canClearCompletedTasks')) {
                showNotification('Only CEO and Managers can clear completed tasks', 'error');
                return;
            }
            
            if (!confirm('Are you sure you want to delete all completed tasks? This action cannot be undone.')) {
                return;
            }
            
            const completedCount = tasks.filter(t => t.status === 'completed').length;
            
            tasks = tasks.filter(task => task.status !== 'completed');
            saveToIndexedDB();
            
            addActivity(currentUser, currentUserId, currentRole, `cleared ${completedCount} completed tasks`);
            
            loadOverviewData();
            loadTasksData();
            if (isPersonalMode) loadPersonalTasks();
            
            showNotification(`Cleared ${completedCount} completed tasks!`);
        }

        function viewMember(memberId) {
            const member = teamMembers.find(m => m.id === memberId);
            if (!member) return;
            
            const content = document.getElementById('memberDetailsContent');
            
            let roleText = member.role.charAt(0).toUpperCase() + member.role.slice(1);
            if (member.role === 'ceo') roleText = 'CEO';
            
            let statusText = member.status.charAt(0).toUpperCase() + member.status.slice(1);
            let statusClass = member.status === 'online' ? 'online' : 'offline';
            
            const joinDate = new Date(member.joinDate);
            const lastLogin = member.lastLogin ? new Date(member.lastLogin) : null;
            
            const createdByMember = member.createdBy ? teamMembers.find(m => m.id === member.createdBy) : null;
            const createdByName = createdByMember ? createdByMember.fullName : (member.createdBy === 'system' ? 'System' : 'Unknown');
            
            const memberImageData = imageCache.get(member.id);
            
            let profileHtml = '';
            if (memberImageData) {
                profileHtml = `<img src="${memberImageData}" class="member-profile-image" style="display: block; margin: 0 auto 15px;">`;
            } else {
                profileHtml = `<div class="member-profile-placeholder">${member.fullName.charAt(0).toUpperCase()}</div>`;
            }
            
            content.innerHTML = `
                <div style="text-align: center; margin-bottom: 20px;">
                    ${profileHtml}
                    <h3 style="margin-bottom: 5px;">${member.fullName}</h3>
                    <div style="color: #4cc9f0; margin-bottom: 15px;">
                        <span class="online-badge ${statusClass}">${statusText}</span>
                        <span style="margin: 0 10px;">•</span>
                        <span class="role-badge role-${member.role}">${roleText}</span>
                    </div>
                </div>
                
                <div style="background: var(--data-bg); border-radius: 10px; padding: 15px; margin-bottom: 15px;">
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                        <div>
                            <div style="font-size: 12px; color: rgba(255, 255, 255, 0.7); margin-bottom: 5px;">Username</div>
                            <div style="font-weight: 700;">${member.username}</div>
                        </div>
                        <div>
                            <div style="font-size: 12px; color: rgba(255, 255, 255, 0.7); margin-bottom: 5px;">Employee ID</div>
                            <div style="font-weight: 700;">${member.employeeId || 'Not assigned'}</div>
                        </div>
                        <div>
                            <div style="font-size: 12px; color: rgba(255, 255, 255, 0.7); margin-bottom: 5px;">Email</div>
                            <div style="font-weight: 700;">${member.email}</div>
                        </div>
                        <div>
                            <div style="font-size: 12px; color: rgba(255, 255, 255, 0.7); margin-bottom: 5px;">Phone</div>
                            <div style="font-weight: 700;">${member.phone}</div>
                        </div>
                        <div>
                            <div style="font-size: 12px; color: rgba(255, 255, 255, 0.7); margin-bottom: 5px;">Department</div>
                            <div style="font-weight: 700;">${member.department}</div>
                        </div>
                        <div>
                            <div style="font-size: 12px; color: rgba(255, 255, 255, 0.7); margin-bottom: 5px;">Created By</div>
                            <div style="font-weight: 700;">${createdByName}</div>
                        </div>
                    </div>
                </div>
                
                <div style="display: flex; justify-content: space-between; background: var(--data-bg); border-radius: 10px; padding: 15px;">
                    <div style="text-align: center;">
                        <div style="font-size: 12px; color: rgba(255, 255, 255, 0.7); margin-bottom: 5px;">Joined</div>
                        <div style="font-weight: 700;">${joinDate.toLocaleDateString()}</div>
                    </div>
                    <div style="text-align: center;">
                        <div style="font-size: 12px; color: rgba(255, 255, 255, 0.7); margin-bottom: 5px;">Last Login</div>
                        <div style="font-weight: 700;">${lastLogin ? lastLogin.toLocaleString() : 'Never'}</div>
                    </div>
                    <div style="text-align: center;">
                        <div style="font-size: 12px; color: rgba(255, 255, 255, 0.7); margin-bottom: 5px;">Assigned Tasks</div>
                        <div style="font-weight: 700; color: #4cc9f0;">${tasks.filter(t => t.assignee === member.id).length}</div>
                    </div>
                </div>
            `;
            
            document.getElementById('viewMemberModal').style.display = 'flex';
        }

        function editMemberModal(memberId) {
            if (!hasPermission('canEditPerson')) {
                showNotification('Only CEO and Admin can edit members', 'error');
                return;
            }
            
            const member = teamMembers.find(m => m.id === memberId);
            if (!member) return;
            
            if (member.role === 'ceo' && currentRole !== 'ceo') {
                showNotification('Only CEO can edit CEO accounts', 'error');
                return;
            }
            
            document.getElementById('editMemberId').value = member.id;
            document.getElementById('editMemberFullName').value = member.fullName;
            document.getElementById('editMemberUsername').value = member.username;
            document.getElementById('editMemberEmail').value = member.email;
            document.getElementById('editMemberRole').value = member.role;
            document.getElementById('editMemberDepartment').value = member.department;
            
            document.getElementById('editMemberModal').style.display = 'flex';
        }

        document.getElementById('editMemberForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            if (!hasPermission('canEditPerson')) {
                showNotification('Only CEO and Admin can edit members', 'error');
                return;
            }
            
            const memberId = document.getElementById('editMemberId').value;
            const fullName = document.getElementById('editMemberFullName').value.trim();
            const username = document.getElementById('editMemberUsername').value.trim();
            const email = document.getElementById('editMemberEmail').value.trim();
            const role = document.getElementById('editMemberRole').value;
            const department = document.getElementById('editMemberDepartment').value.trim();
            
            const memberIndex = teamMembers.findIndex(m => m.id === memberId);
            if (memberIndex === -1) return;
            
            if (teamMembers[memberIndex].id === currentUserId && role !== currentRole) {
                showNotification('Cannot change your own role', 'error');
                return;
            }
            
            if (teamMembers[memberIndex].role === 'ceo' && currentRole !== 'ceo') {
                showNotification('Only CEO can edit CEO accounts', 'error');
                return;
            }
            
            if (currentRole !== 'ceo' && role === 'ceo') {
                showNotification('Only CEO can assign CEO role', 'error');
                return;
            }
            
            const oldRole = teamMembers[memberIndex].role;
            teamMembers[memberIndex].fullName = fullName;
            teamMembers[memberIndex].username = username;
            teamMembers[memberIndex].email = email;
            teamMembers[memberIndex].role = role;
            teamMembers[memberIndex].department = department;
            teamMembers[memberIndex].updated_at = new Date().toISOString();
            
            saveToIndexedDB();
            
            if (oldRole !== role) {
                addActivity(currentUser, currentUserId, currentRole, `changed ${fullName}'s role from ${oldRole} to ${role}`);
            } else {
                addActivity(currentUser, currentUserId, currentRole, `updated member: ${fullName} (${username})`);
            }
            
            document.getElementById('editMemberModal').style.display = 'none';
            
            loadTeamData();
            
            showNotification('Member updated successfully!');
        });

        function promoteMember(memberId) {
            if (!hasPermission('canPromotePerson')) {
                showNotification('Only CEO can promote members', 'error');
                return;
            }
            
            const member = teamMembers.find(m => m.id === memberId);
            if (!member) return;
            
            const roleHierarchy = ['member', 'admin', 'manager', 'ceo'];
            const currentIndex = roleHierarchy.indexOf(member.role);
            
            if (currentIndex < roleHierarchy.length - 1) {
                const newRole = roleHierarchy[currentIndex + 1];
                
                if (confirm(`Promote ${member.fullName} from ${member.role} to ${newRole}?`)) {
                    const oldRole = member.role;
                    member.role = newRole;
                    saveToIndexedDB();
                    
                    addActivity(currentUser, currentUserId, currentRole, `promoted ${member.fullName} from ${oldRole} to ${newRole}`);
                    loadTeamData();
                    
                    showNotification(`Member promoted to ${newRole}!`);
                }
            } else {
                showNotification('Member is already at the highest role', 'error');
            }
        }

        function deleteMember(memberId) {
            if (!hasPermission('canDeletePerson')) {
                showNotification('Only CEO can delete members', 'error');
                return;
            }
            
            const member = teamMembers.find(m => m.id === memberId);
            if (!member) return;
            
            if (memberId === currentUserId) {
                showNotification('You cannot delete your own account!', 'error');
                return;
            }
            
            if (member.role === 'ceo') {
                showNotification('Cannot delete CEO account', 'error');
                return;
            }
            
            if (!confirm(`Are you sure you want to delete ${member.fullName}? This action cannot be undone.`)) {
                return;
            }
            
            const memberIndex = teamMembers.findIndex(m => m.id === memberId);
            teamMembers.splice(memberIndex, 1);
            saveToIndexedDB();
            
            tasks = tasks.filter(task => task.assignee !== member.id);
            
            addActivity(currentUser, currentUserId, currentRole, `deleted team member: ${member.fullName} (${member.username})`);
            
            loadOverviewData();
            loadTeamData();
            loadTasksData();
            
            showNotification('Team member deleted successfully!');
        }

        function addActivity(user, userId, userRole, action) {
            const activity = {
                id: generateId(),
                user: user,
                userId: userId,
                userRole: userRole,
                action: action,
                timestamp: new Date().toISOString(),
                type: 'user',
                details: `Performed by: ${user} (${userRole}) at ${new Date().toLocaleString()}`
            };
            
            activities.push(activity);
            
            if (activities.length > 100) {
                activities = activities.slice(-100);
            }
            
            saveToIndexedDB();
            
            if (!isPersonalMode && document.getElementById('activityTab').style.display !== 'none') {
                loadActivityData();
            }
            
            if (isPersonalMode && userId === currentUserId) {
                loadPersonalActivities();
            }
        }

        function clearAllActivities() {
            if (!hasPermission('canClearActivities')) {
                showNotification('Only Managers can clear activities', 'error');
                return;
            }
            
            if (!confirm('Are you sure you want to clear all activity logs? This action cannot be undone.')) {
                return;
            }
            
            activities = [];
            saveToIndexedDB();
            loadActivityData();
            
            addActivity(currentUser, currentUserId, currentRole, 'cleared all activity logs');
            showNotification('All activities cleared!');
        }

        function deleteActivity(activityId) {
            if (!hasPermission('canClearActivities')) {
                showNotification('Only Managers can delete activities', 'error');
                return;
            }
            
            const activityIndex = activities.findIndex(a => a.id === activityId);
            if (activityIndex === -1) return;
            
            activities.splice(activityIndex, 1);
            saveToIndexedDB();
            loadActivityData();
            
            showNotification('Activity deleted');
        }

        function showChangePasswordModal() {
            document.getElementById('changePasswordForm').reset();
            document.getElementById('changePasswordError').style.display = 'none';
            document.getElementById('changePasswordModal').style.display = 'flex';
        }

        document.getElementById('changePasswordForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const errorDiv = document.getElementById('changePasswordError');
            errorDiv.style.display = 'none';
            
            const currentPassword = document.getElementById('currentPassword').value;
            const newPassword = document.getElementById('newPassword').value;
            const confirmNewPassword = document.getElementById('confirmNewPassword').value;
            
            const userIndex = teamMembers.findIndex(m => m.id === currentUserId);
            if (userIndex === -1) return;
            
            if (teamMembers[userIndex].password !== currentPassword) {
                errorDiv.textContent = 'Current password is incorrect';
                errorDiv.style.display = 'block';
                return;
            }
            
            if (newPassword.length < 6) {
                errorDiv.textContent = 'New password must be at least 6 characters';
                errorDiv.style.display = 'block';
                return;
            }
            
            if (newPassword !== confirmNewPassword) {
                errorDiv.textContent = 'New passwords do not match';
                errorDiv.style.display = 'block';
                return;
            }
            
            teamMembers[userIndex].password = newPassword;
            saveToIndexedDB();
            
            addActivity(currentUser, currentUserId, currentRole, 'changed password');
            
            document.getElementById('changePasswordModal').style.display = 'none';
            
            showNotification('Password changed successfully!');
        });

        function setupActivityMonitoring() {
            setInterval(() => {
                const now = Date.now();
                if (now - lastActivityCheck > 30000) {
                    updateUserStatus();
                    lastActivityCheck = now;
                }
            }, 10000);
        }

        function updateUserStatus() {
            if (currentUserId) {
                const user = teamMembers.find(m => m.id === currentUserId);
                if (user && user.status !== 'online') {
                    user.status = 'online';
                    saveToIndexedDB();
                    loadTeamData();
                    loadTeamStatus();
                }
            }
        }

        function showExitModal() {
            const userTasks = tasks.filter(task => task.assignee === currentUserId).length;
            const onlineCount = teamMembers.filter(m => m.status === 'online').length;
            const completedTasks = tasks.filter(t => t.status === 'completed').length;
            
            document.getElementById('exitTaskCount').textContent = userTasks;
            document.getElementById('exitOnlineCount').textContent = onlineCount;
            document.getElementById('exitCompleted').textContent = completedTasks;
            document.getElementById('exitActivity').textContent = activities.length;
            
            secondsRemaining = 60;
            updateCountdown();
            
            if (countdownInterval) clearInterval(countdownInterval);
            countdownInterval = setInterval(() => {
                secondsRemaining--;
                updateCountdown();
                
                if (secondsRemaining <= 0) {
                    clearInterval(countdownInterval);
                    logout();
                }
            }, 1000);
            
            document.getElementById('exitModal').style.display = 'flex';
        }

        function updateCountdown() {
            const countdownElement = document.getElementById('countdownTimer');
            if (countdownElement) {
                countdownElement.textContent = `Auto logout in: ${secondsRemaining}s`;
            }
        }

        function logout() {
            if (countdownInterval) clearInterval(countdownInterval);
            if (syncInterval) clearInterval(syncInterval);
            if (realTimeInterval) clearInterval(realTimeInterval);
            
            const userIndex = teamMembers.findIndex(m => m.id === currentUserId);
            if (userIndex !== -1) {
                teamMembers[userIndex].status = 'offline';
                saveToIndexedDB();
            }
            
            addActivity(currentUser, currentUserId, currentRole, 'logged out');
            
            localStorage.removeItem('currentSession');
            
            document.getElementById('mainDashboard').style.display = 'none';
            document.getElementById('personalDashboard').style.display = 'none';
            document.getElementById('exitModal').style.display = 'none';
            document.getElementById('modernUploadModal').style.display = 'none';
            
            if (currentRole === 'ceo' || currentRole === 'admin' || currentRole === 'manager') {
                showAdminLogin();
            } else {
                showPersonalLogin();
            }
            
            currentUser = null;
            currentRole = null;
            currentUserId = null;
            
            resetTapCounters();
            
            showNotification('Logged out successfully');
        }

        function toggleFontSize(size) {
            document.body.classList.remove('font-small', 'font-medium', 'font-large');
            document.body.classList.add('font-' + size);
        }

        function applyPermissions() {
            const permissionElements = document.querySelectorAll('.permission-hidden');
            permissionElements.forEach(el => {
                el.style.display = 'none';
            });
            
            if (hasPermission('canAddTask')) {
                const addTaskBtn = document.getElementById('addTaskBtn');
                if (addTaskBtn) addTaskBtn.style.display = 'inline-flex';
                
                const quickAddTaskBtn = document.getElementById('quickAddTaskBtn');
                if (quickAddTaskBtn) quickAddTaskBtn.style.display = 'flex';
            }
            
            if (hasPermission('canAddPerson')) {
                const addPersonBtn = document.getElementById('addPersonBtn');
                if (addPersonBtn) addPersonBtn.style.display = 'inline-flex';
                
                const quickAddMemberBtn = document.getElementById('quickAddMemberBtn');
                if (quickAddMemberBtn) quickAddMemberBtn.style.display = 'flex';
            }
            
            if (hasPermission('canClearActivities')) {
                const clearBtn = document.getElementById('clearActivitiesBtn');
                if (clearBtn) clearBtn.style.display = 'inline-flex';
            }
            
            if (hasPermission('canClearCompletedTasks')) {
                const clearCompletedBtn = document.getElementById('clearCompletedBtn');
                if (clearCompletedBtn) clearCompletedBtn.style.display = 'inline-flex';
            }
        }

        function initEventListeners() {
            document.querySelectorAll('.close-modal').forEach(button => {
                button.addEventListener('click', function() {
                    this.closest('.modal').style.display = 'none';
                });
            });
            
            document.querySelectorAll('.modal').forEach(modal => {
                modal.addEventListener('click', function(e) {
                    if (e.target === this) {
                        this.style.display = 'none';
                    }
                });
            });
            
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') {
                    document.getElementById('modernUploadModal').style.display = 'none';
                    resetTapCounters();
                }
            });
            
            const profileContainer = document.getElementById('profileContainer');
            const personalProfileContainer = document.getElementById('personalProfileContainer');
            
            if (profileContainer) {
                profileContainer.addEventListener('click', () => handleProfileTap('main'));
                profileContainer.addEventListener('touchstart', (e) => {
                    e.preventDefault();
                    handleProfileTap('main');
                }, { passive: false });
            }
            
            if (personalProfileContainer) {
                personalProfileContainer.addEventListener('click', () => handleProfileTap('personal'));
                personalProfileContainer.addEventListener('touchstart', (e) => {
                    e.preventDefault();
                    handleProfileTap('personal');
                }, { passive: false });
            }
            
            document.addEventListener('mousemove', () => {
                lastActivityCheck = Date.now();
                if (currentUserId) {
                    const user = teamMembers.find(m => m.id === currentUserId);
                    if (user && user.status !== 'online') {
                        user.status = 'online';
                        saveToIndexedDB();
                    }
                }
            });
            
            document.addEventListener('keydown', () => {
                lastActivityCheck = Date.now();
                if (currentUserId) {
                    const user = teamMembers.find(m => m.id === currentUserId);
                    if (user && user.status !== 'online') {
                        user.status = 'online';
                        saveToIndexedDB();
                    }
                }
            });
        }

        function showNotification(message, type = 'success') {
            const notification = document.getElementById('notification');
            const text = document.getElementById('notificationText');
            
            text.textContent = message;
            
            if (type === 'error') {
                notification.style.background = 'rgba(239, 68, 68, 0.9)';
            } else if (type === 'warning') {
                notification.style.background = 'rgba(255, 193, 7, 0.9)';
            } else if (type === 'info') {
                notification.style.background = 'rgba(76, 201, 240, 0.7)';
            } else {
                notification.style.background = 'rgba(76, 201, 240, 0.9)';
            }
            
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        window.addEventListener('beforeunload', function() {
            if (currentUserId) {
                const userIndex = teamMembers.findIndex(m => m.id === currentUserId);
                if (userIndex !== -1) {
                    teamMembers[userIndex].status = 'offline';
                    saveToIndexedDB();
                }
            }
            
            if (networkStatusInterval) clearInterval(networkStatusInterval);
            if (countdownInterval) clearInterval(countdownInterval);
            if (syncInterval) clearInterval(syncInterval);
            if (realTimeInterval) clearInterval(realTimeInterval);
            
            resetTapCounters();
        });

        updateTabs();
    </script>
</body>
</html>